import{c as R,D as at,J as vn,z as C,g as J,a1 as Tt,a8 as Gt,x as Y,I as yn,F as wn,a9 as xn,T as Z,a0 as St,a3 as ke}from"./static-aza_T-_E.js";const H=Symbol("cmds");class bn{constructor(e){this.std=e,this._commands=new Map,this._getCommandCtx=()=>({std:this.std}),this.createChain=(t,n)=>{const i=this._getCommandCtx,r=this.createChain,o=this.pipe,l=(a,[c,...d])=>{c&&c(a,h=>l({...a,...h},d))};return{[H]:n,run:function(){const a=i();let c=!1;try{const d=this[H];l(a,[...d,(h,u)=>{c=!0,u()}])}catch(d){console.error(d)}return c},with:function(a){const c=this[H];return r(t,[...c,(d,h)=>h(a)])},inline:function(a){const c=this[H];return r(t,[...c,a])},try:function(a){const c=this[H];return r(t,[...c,(d,h)=>{let u=d;const f=a(o());for(const p of f)if(p[H]=[(w,m)=>{m(u)},...p[H]],p.inline((w,m)=>{u={...u,...w},m()}).run()){h(u);break}}])},tryAll:function(a){const c=this[H];return r(t,[...c,(d,h)=>{let u=d;const f=a(o());let p=!0;for(const _ of f)_[H]=[(m,x)=>{x(u)},..._[H]],_.inline((m,x)=>{u={...u,...m},x()}).run()&&(p=!1);p||h(u)}])},...t}},this.pipe=()=>{const t={},n=this.createChain;for(const[i,r]of this._commands.entries())t[i]=function(o){const l=this[H];return n(t,[...l,(a,c)=>r({...a,...o},c)])};return n(t,[])},this.getChainCtx=t=>{const n={};return t.inline((i,r)=>{Object.assign(n,i),r()}).run(),n}}add(e,t){return this._commands.set(e,t),this}}class it{constructor(e){this.event=e,this.type="defaultState"}}class dt{constructor(){this._map={},this.add=e=>{const t=e.type;this._map[t]&&console.warn("UIEventStateContext: state name duplicated",t),this._map[t]=e},this.has=e=>!!this._map[e],this.get=e=>{const t=this._map[e];return R(t,`UIEventStateContext: state ${e} not found`),t}}static from(...e){const t=new dt;return e.forEach(n=>{t.add(n)}),t}}class A{constructor(){}static{this.id=e=>e[e.length-1]}static{this.parent=e=>e.slice(0,e.length-1)}static{this.pathToKey=e=>e.join("|")}static{this.keyToPath=e=>e.split("|")}static{this.equals=(e,t)=>A.pathToKey(e)===A.pathToKey(t)}static{this.includes=(e,t)=>A.pathToKey(e).startsWith(A.pathToKey(t))}}class ae extends it{constructor({event:e}){super(e),this.type="clipboardState",this.raw=e}}class En{constructor(e){this._dispatcher=e,this._cut=t=>{if(!this._dispatcher.isActive)return;const n=new ae({event:t});this._dispatcher.run("cut",this._createContext(t,n))},this._copy=t=>{if(!this._dispatcher.isActive)return;const n=new ae({event:t});this._dispatcher.run("copy",this._createContext(t,n))},this._paste=t=>{if(!this._dispatcher.isActive)return;const n=new ae({event:t});this._dispatcher.run("paste",this._createContext(t,n))}}_createContext(e,t){return dt.from(new it(e),t)}listen(){this._dispatcher.disposables.addFromEvent(document,"cut",this._cut),this._dispatcher.disposables.addFromEvent(document,"copy",this._copy),this._dispatcher.disposables.addFromEvent(document,"paste",this._paste)}}var et={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},Bt={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},Sn=typeof navigator<"u"&&/Mac/.test(navigator.platform),Rn=typeof navigator<"u"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);for(var $=0;$<10;$++)et[48+$]=et[96+$]=String($);for(var $=1;$<=24;$++)et[$+111]="F"+$;for(var $=65;$<=90;$++)et[$]=String.fromCharCode($+32),Bt[$]=String.fromCharCode($);for(var le in et)Bt.hasOwnProperty(le)||(Bt[le]=et[le]);function Cn(s){var e=Sn&&s.metaKey&&s.shiftKey&&!s.ctrlKey&&!s.altKey||Rn&&s.shiftKey&&s.key&&s.key.length==1||s.key=="Unidentified",t=!e&&s.key||(s.shiftKey?Bt:et)[s.keyCode]||s.key||"Unidentified";return t=="Esc"&&(t="Escape"),t=="Del"&&(t="Delete"),t=="Left"&&(t="ArrowLeft"),t=="Up"&&(t="ArrowUp"),t=="Right"&&(t="ArrowRight"),t=="Down"&&(t="ArrowDown"),t}const Tn=typeof navigator<"u"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):!1;function An(s){const e=s.split(/-(?!$)/);let t=e.at(-1);t==="Space"&&(t=" ");let n,i,r,o;return e.slice(0,-1).forEach(l=>{if(/^(cmd|meta|m)$/i.test(l)){o=!0;return}if(/^a(lt)?$/i.test(l)){n=!0;return}if(/^(c|ctrl|control)$/i.test(l)){i=!0;return}if(/^s(hift)?$/i.test(l)){r=!0;return}if(/^mod$/i.test(l)){Tn?o=!0:i=!0;return}throw new Error("Unrecognized modifier name: "+l)}),n&&(t="Alt-"+t),i&&(t="Ctrl-"+t),o&&(t="Meta-"+t),r&&(t="Shift-"+t),t}function ce(s,e,t=!0){return e.altKey&&(s="Alt-"+s),e.ctrlKey&&(s="Ctrl-"+s),e.metaKey&&(s="Meta-"+s),t&&e.shiftKey&&(s="Shift-"+s),s}function On(s){const e=Object.create(null);for(const t in s)e[An(t)]=s[t];return e}function $n(s){const e=On(s);return t=>{const i=t.get("keyboardState").raw,r=Cn(i),o=e[ce(r,i)];if(o&&o(t))return!0;if(r.length!==1||r===" ")return!1;if(i.shiftKey){const c=e[ce(r,i,!1)];if(c&&c(t))return!0}const l=i.shiftKey||i.altKey||i.metaKey||r.charCodeAt(0)>127,a=et[i.keyCode];if(l&&a&&a!==r){const c=e[ce(a,i)];if(c&&c(t))return!0}return!1}}class De extends it{constructor({event:e,composing:t}){super(e),this.type="keyboardState",this.raw=e,this.composing=t}}class Rt extends it{constructor({event:e,rect:t,startX:n,startY:i,last:r}){super(e),this.type="pointerState";const o=e.clientX-t.left,l=e.clientY-t.top;this.raw=e,this.point={x:o,y:l},this.containerOffset={x:t.left,y:t.top},this.start={x:n,y:i},this.delta=r?{x:o-r.point.x,y:l-r.point.y}:{x:0,y:0},this.keys={shift:e.shiftKey,cmd:e.metaKey||e.ctrlKey,alt:e.altKey},this.button=r?.button||e.button,this.dragging=!!r}get x(){return this.point.x}get y(){return this.point.y}}class Pn{constructor(e){this._dispatcher=e,this.composition=!1,this._down=t=>{if(!this._dispatcher.isActive)return;const n=new De({event:t,composing:this.composition});this._dispatcher.run("keyDown",this._createContext(t,n))},this._up=t=>{if(!this._dispatcher.isActive)return;const n=new De({event:t,composing:this.composition});this._dispatcher.run("keyUp",this._createContext(t,n))}}_createContext(e,t){return dt.from(new it(e),t)}listen(){this._dispatcher.disposables.addFromEvent(document,"keydown",this._down),this._dispatcher.disposables.addFromEvent(document,"keyup",this._up),this._dispatcher.disposables.addFromEvent(document,"compositionstart",()=>{this.composition=!0}),this._dispatcher.disposables.addFromEvent(document,"compositionend",()=>{this.composition=!1})}bindHotkey(e,t){return this._dispatcher.add("keyDown",n=>this.composition?!1:$n(e)(n),t)}}function Ie(s,e){const t=s.x-e.x,n=s.y-e.y;return Math.pow(t,2)+Math.pow(n,2)>4}const kn=s=>s.toLowerCase();class Dn{constructor(e){this._dispatcher=e,this._lastPointerDownEvent=null,this._startDragState=null,this._lastDragState=null,this._pointerDownCount=0,this._dragging=!1,this._startX=-1/0,this._startY=-1/0,this._alreadyDown=!1,this._alreadyUp=!1,this._reset=()=>{this._startX=-1/0,this._startY=-1/0,this._lastDragState=null,this._dragging=!1},this._down=t=>{if(this._alreadyUp=!1,this._alreadyDown)return;this._alreadyDown=!0,this._dispatcher.activate(),this._lastPointerDownEvent&&t.timeStamp-this._lastPointerDownEvent.timeStamp<500&&!Ie(t,this._lastPointerDownEvent)?this._pointerDownCount++:this._pointerDownCount=1;const n=new Rt({event:t,rect:this._rect,startX:this._startX,startY:this._startY,last:null});this._startX=n.point.x,this._startY=n.point.y,this._startDragState=n,this._lastDragState=n,this._lastPointerDownEvent=t,this._dispatcher.run("pointerDown",this._createContext(t,n)),this._dispatcher.disposables.addFromEvent(document,"pointermove",this._move),this._dispatcher.disposables.addFromEvent(document,"touchmove",this._touchmove),this._dispatcher.disposables.addFromEvent(document,"pointerup",this._up),this._dispatcher.disposables.addFromEvent(document,"touchend",this._touchup)},this._touchup=t=>this._up(this.getFakePointerEvent(t)),this._touchmove=t=>this._move(this.getFakePointerEvent(t)),this._touchOut=t=>this._out(this.getFakePointerEvent(t)),this._touchMoveOn=t=>this._moveOn(this.getFakePointerEvent(t)),this._touchDown=t=>this._down(this.getFakePointerEvent(t)),this._up=t=>{if(this._alreadyDown=!1,this._alreadyUp)return;this._alreadyUp=!0;const n=new Rt({event:t,rect:this._rect,startX:this._startX,startY:this._startY,last:this._lastDragState}),i=this._createContext(t,n);(()=>{if(this._dragging){this._dispatcher.run("dragEnd",i);return}this._dispatcher.run("click",i),this._pointerDownCount===2&&this._dispatcher.run("doubleClick",i),this._pointerDownCount===3&&this._dispatcher.run("tripleClick",i)})(),this._dispatcher.run("pointerUp",i),this._reset(),document.removeEventListener("pointermove",this._move),document.removeEventListener("pointerup",this._up),document.removeEventListener("touchend",this._touchup),document.removeEventListener("touchmove",this._touchmove)},this._move=t=>{const n=this._lastDragState,i=new Rt({event:t,rect:this._rect,startX:this._startX,startY:this._startY,last:n});this._lastDragState=i,R(this._startDragState),!this._dragging&&Ie(this._startDragState.raw,i.raw)&&(this._dragging=!0,this._dispatcher.run("dragStart",this._createContext(t,this._startDragState))),this._dragging&&this._dispatcher.run("dragMove",this._createContext(t,i))},this._moveOn=t=>{const n=new Rt({event:t,rect:this._rect,startX:this._startX,startY:this._startY,last:this._lastDragState});this._dispatcher.run("pointerMove",this._createContext(t,n))},this._out=t=>{this._alreadyDown=!1;const n=new Rt({event:t,rect:this._rect,startX:-1/0,startY:-1/0,last:null});this._dispatcher.run("pointerOut",this._createContext(t,n))}}listen(){this._dispatcher.disposables.addFromEvent(this._dispatcher.host,"pointerdown",this._down),this._dispatcher.disposables.addFromEvent(this._dispatcher.host,"pointermove",this._moveOn),this._dispatcher.disposables.addFromEvent(this._dispatcher.host,"pointerout",this._out),this._dispatcher.disposables.addFromEvent(this._dispatcher.host,"touchmove",this._touchMoveOn),this._dispatcher.disposables.addFromEvent(this._dispatcher.host,"touchstart",this._touchDown),this._dispatcher.disposables.addFromEvent(this._dispatcher.host,"touchcancel",this._touchOut)}get _rect(){return this._dispatcher.host.getBoundingClientRect()}_createContext(e,t){return dt.from(new it(e),t)}getFakePointerEvent(e){return e.clientX=e.touches[0].clientX,e.clientY=e.touches[0].clientY,e}}class In{constructor(e){this._dispatcher=e,this._prev=null,this._compositionUpdate=t=>{const n=this._buildScope("compositionUpdate");this._dispatcher.run("compositionUpdate",this._createContext(t),n)},this._compositionStart=t=>{const n=this._buildScope("compositionStart");this._dispatcher.run("compositionStart",this._createContext(t),n)},this._compositionEnd=t=>{const n=this._buildScope("compositionEnd");this._dispatcher.run("compositionEnd",this._createContext(t),n)},this._selectionChange=t=>{if(!this._dispatcher.isActive)return;const n=this._buildScope("selectionChange");this._dispatcher.run("selectionChange",this._createContext(t),n)},this._buildScope=t=>{let n;const i=document.getSelection();if(i&&i.rangeCount>0){const r=i.getRangeAt(0);n=this._buildEventScopeByNativeRange(t,r),this._prev=r}else this._prev!==null&&(n=this._buildEventScopeByNativeRange(t,this._prev),this._prev=null);return n}}listen(){this._dispatcher.disposables.addFromEvent(document,"selectionchange",this._selectionChange),this._dispatcher.disposables.addFromEvent(document,"compositionstart",this._compositionStart),this._dispatcher.disposables.addFromEvent(document,"compositionend",this._compositionEnd),this._dispatcher.disposables.addFromEvent(document,"compositionupdate",this._compositionUpdate)}_createContext(e){return dt.from(new it(e))}_buildEventScopeByNativeRange(e,t){const i=this._findBlockElementPath(t).map(o=>o).filter(o=>!!o),r=Array.from(new Set(i.flatMap(o=>o.map(l=>this._dispatcher.std.page.getBlockById(l)?.flavour)).filter(o=>!!o))).reverse();return this._dispatcher.buildEventScope(e,r,i)}_findBlockElementPath(e){const t=e.startContainer,n=e.endContainer,i=e.commonAncestorContainer,r=this._dispatcher.std.view.getNodeView;if(i.nodeType===Node.TEXT_NODE){const d=r(i);if(d)return[d.path]}const o=new Set;let l=!1;const a=(d,h)=>{if(d&&d!==h){if(d===n){o.add(d),l=!1;return}d===t&&(l=!0),l&&(d.nodeType===Node.TEXT_NODE||d.nodeType===Node.ELEMENT_NODE)&&o.add(d),a(d.firstChild,h),a(d.nextSibling,h)}};a(i.firstChild,i);const c=new Set;return o.forEach(d=>{const h=r(d);h&&(c.has(h.path)||c.add(h.path))}),Array.from(c)}}const tn=["beforeInput","blur","focus","drop","contextMenu","wheel"],Mn=["click","doubleClick","tripleClick","pointerDown","pointerMove","pointerUp","pointerOut","dragStart","dragMove","dragEnd","keyDown","keyUp","selectionChange","compositionStart","compositionUpdate","compositionEnd","cut","copy","paste",...tn];class ot{constructor(e){this.std=e,this.disposables=new at,this._handlersMap=Object.fromEntries(Mn.map(t=>[t,[]])),this.activate=()=>{const t=ot._activeDispatcher;t!==this&&(ot._activeDispatcher=this,t?.std.selection.clear())},this.deactivate=()=>{const t=ot._activeDispatcher;t&&t===this&&(ot._activeDispatcher=null,t.std.selection.clear())},this.bindHotkey=(...t)=>this._keyboardControl.bindHotkey(...t),this._pointerControl=new Dn(this),this._keyboardControl=new Pn(this),this._rangeControl=new In(this),this._clipboardControl=new En(this)}static{this._activeDispatcher=null}get isActive(){return ot._activeDispatcher===this}mount(){this.disposables.disposed&&(this.disposables=new at),this._bindEvents()}unmount(){this.disposables.dispose()}get host(){return this.std.host}run(e,t,n){const{event:i}=t.get("defaultState");if(!(!n&&(n=this._getEventScope(e,i),!n)))for(const r of n.runners){const{fn:o}=r;if(o(t))return}}add(e,t,n){const i={fn:t,flavour:n?.flavour,path:n?.path};return this._handlersMap[e].unshift(i),()=>{this._handlersMap[e].includes(i)&&(this._handlersMap[e]=this._handlersMap[e].filter(r=>r!==i))}}get _currentSelections(){return this.std.selection.value}_getEventScope(e,t){if(!this._handlersMap[e])return;let i;return t.target&&t.target instanceof Node&&(i=this._buildEventScopeByTarget(e,t.target)),i||(i=this._buildEventScopeBySelection(e)),i}buildEventScope(e,t,n){const i=this._handlersMap[e];if(!i)return;const r=i.filter(a=>a.flavour===void 0&&a.path===void 0),o=i.filter(a=>{const c=a.path;return c===void 0?!1:n.some(d=>A.includes(d,c))}),l=i.filter(a=>a.flavour&&t.includes(a.flavour));return{runners:o.concat(l).concat(r),flavours:t,paths:n}}_buildEventScopeByTarget(e,t){if(!this._handlersMap[e])return;const i=this.std.view.getNodeView(t)?.path;if(!i)return;const r=i.map(o=>this.std.page.getBlockById(o)?.flavour).filter(o=>!!o).reverse();return this.buildEventScope(e,r,[i])}_buildEventScopeBySelection(e){if(!this._handlersMap[e])return;const n=this._currentSelections,i={},r=n.map(l=>l.path).flatMap(l=>l.map(a=>this.std.page.getBlockById(a)?.flavour)).filter(l=>!l||i[l]?!1:(i[l]=!0,!0)).reverse(),o=n.map(l=>l.path);return this.buildEventScope(e,r,o)}_bindEvents(){tn.forEach(e=>{this.disposables.addFromEvent(this.host,kn(e),t=>{this.run(e,dt.from(new it(t)))})}),this._pointerControl.listen(),this._keyboardControl.listen(),this._rangeControl.listen(),this._clipboardControl.listen()}}var _e={exports:{}};_e.exports;(function(s){var e=function(){var t=String.fromCharCode,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",r={};function o(a,c){if(!r[a]){r[a]={};for(var d=0;d<a.length;d++)r[a][a.charAt(d)]=d}return r[a][c]}var l={compressToBase64:function(a){if(a==null)return"";var c=l._compress(a,6,function(d){return n.charAt(d)});switch(c.length%4){default:case 0:return c;case 1:return c+"===";case 2:return c+"==";case 3:return c+"="}},decompressFromBase64:function(a){return a==null?"":a==""?null:l._decompress(a.length,32,function(c){return o(n,a.charAt(c))})},compressToUTF16:function(a){return a==null?"":l._compress(a,15,function(c){return t(c+32)})+" "},decompressFromUTF16:function(a){return a==null?"":a==""?null:l._decompress(a.length,16384,function(c){return a.charCodeAt(c)-32})},compressToUint8Array:function(a){for(var c=l.compress(a),d=new Uint8Array(c.length*2),h=0,u=c.length;h<u;h++){var f=c.charCodeAt(h);d[h*2]=f>>>8,d[h*2+1]=f%256}return d},decompressFromUint8Array:function(a){if(a==null)return l.decompress(a);for(var c=new Array(a.length/2),d=0,h=c.length;d<h;d++)c[d]=a[d*2]*256+a[d*2+1];var u=[];return c.forEach(function(f){u.push(t(f))}),l.decompress(u.join(""))},compressToEncodedURIComponent:function(a){return a==null?"":l._compress(a,6,function(c){return i.charAt(c)})},decompressFromEncodedURIComponent:function(a){return a==null?"":a==""?null:(a=a.replace(/ /g,"+"),l._decompress(a.length,32,function(c){return o(i,a.charAt(c))}))},compress:function(a){return l._compress(a,16,function(c){return t(c)})},_compress:function(a,c,d){if(a==null)return"";var h,u,f={},p={},_="",w="",m="",x=2,v=3,S=2,b=[],g=0,y=0,E;for(E=0;E<a.length;E+=1)if(_=a.charAt(E),Object.prototype.hasOwnProperty.call(f,_)||(f[_]=v++,p[_]=!0),w=m+_,Object.prototype.hasOwnProperty.call(f,w))m=w;else{if(Object.prototype.hasOwnProperty.call(p,m)){if(m.charCodeAt(0)<256){for(h=0;h<S;h++)g=g<<1,y==c-1?(y=0,b.push(d(g)),g=0):y++;for(u=m.charCodeAt(0),h=0;h<8;h++)g=g<<1|u&1,y==c-1?(y=0,b.push(d(g)),g=0):y++,u=u>>1}else{for(u=1,h=0;h<S;h++)g=g<<1|u,y==c-1?(y=0,b.push(d(g)),g=0):y++,u=0;for(u=m.charCodeAt(0),h=0;h<16;h++)g=g<<1|u&1,y==c-1?(y=0,b.push(d(g)),g=0):y++,u=u>>1}x--,x==0&&(x=Math.pow(2,S),S++),delete p[m]}else for(u=f[m],h=0;h<S;h++)g=g<<1|u&1,y==c-1?(y=0,b.push(d(g)),g=0):y++,u=u>>1;x--,x==0&&(x=Math.pow(2,S),S++),f[w]=v++,m=String(_)}if(m!==""){if(Object.prototype.hasOwnProperty.call(p,m)){if(m.charCodeAt(0)<256){for(h=0;h<S;h++)g=g<<1,y==c-1?(y=0,b.push(d(g)),g=0):y++;for(u=m.charCodeAt(0),h=0;h<8;h++)g=g<<1|u&1,y==c-1?(y=0,b.push(d(g)),g=0):y++,u=u>>1}else{for(u=1,h=0;h<S;h++)g=g<<1|u,y==c-1?(y=0,b.push(d(g)),g=0):y++,u=0;for(u=m.charCodeAt(0),h=0;h<16;h++)g=g<<1|u&1,y==c-1?(y=0,b.push(d(g)),g=0):y++,u=u>>1}x--,x==0&&(x=Math.pow(2,S),S++),delete p[m]}else for(u=f[m],h=0;h<S;h++)g=g<<1|u&1,y==c-1?(y=0,b.push(d(g)),g=0):y++,u=u>>1;x--,x==0&&(x=Math.pow(2,S),S++)}for(u=2,h=0;h<S;h++)g=g<<1|u&1,y==c-1?(y=0,b.push(d(g)),g=0):y++,u=u>>1;for(;;)if(g=g<<1,y==c-1){b.push(d(g));break}else y++;return b.join("")},decompress:function(a){return a==null?"":a==""?null:l._decompress(a.length,32768,function(c){return a.charCodeAt(c)})},_decompress:function(a,c,d){var h=[],u=4,f=4,p=3,_="",w=[],m,x,v,S,b,g,y,E={val:d(0),position:c,index:1};for(m=0;m<3;m+=1)h[m]=m;for(v=0,b=Math.pow(2,2),g=1;g!=b;)S=E.val&E.position,E.position>>=1,E.position==0&&(E.position=c,E.val=d(E.index++)),v|=(S>0?1:0)*g,g<<=1;switch(v){case 0:for(v=0,b=Math.pow(2,8),g=1;g!=b;)S=E.val&E.position,E.position>>=1,E.position==0&&(E.position=c,E.val=d(E.index++)),v|=(S>0?1:0)*g,g<<=1;y=t(v);break;case 1:for(v=0,b=Math.pow(2,16),g=1;g!=b;)S=E.val&E.position,E.position>>=1,E.position==0&&(E.position=c,E.val=d(E.index++)),v|=(S>0?1:0)*g,g<<=1;y=t(v);break;case 2:return""}for(h[3]=y,x=y,w.push(y);;){if(E.index>a)return"";for(v=0,b=Math.pow(2,p),g=1;g!=b;)S=E.val&E.position,E.position>>=1,E.position==0&&(E.position=c,E.val=d(E.index++)),v|=(S>0?1:0)*g,g<<=1;switch(y=v){case 0:for(v=0,b=Math.pow(2,8),g=1;g!=b;)S=E.val&E.position,E.position>>=1,E.position==0&&(E.position=c,E.val=d(E.index++)),v|=(S>0?1:0)*g,g<<=1;h[f++]=t(v),y=f-1,u--;break;case 1:for(v=0,b=Math.pow(2,16),g=1;g!=b;)S=E.val&E.position,E.position>>=1,E.position==0&&(E.position=c,E.val=d(E.index++)),v|=(S>0?1:0)*g,g<<=1;h[f++]=t(v),y=f-1,u--;break;case 2:return w.join("")}if(u==0&&(u=Math.pow(2,p),p++),h[y])_=h[y];else if(y===f)_=x+x.charAt(0);else return null;w.push(_),h[f++]=x+_.charAt(0),u--,x=_,u==0&&(u=Math.pow(2,p),p++)}}};return l}();s!=null?s.exports=e:typeof angular<"u"&&angular!=null&&angular.module("LZString",[]).factory("LZString",function(){return e})})(_e);var Me=_e.exports;class Nn{constructor(e){this.std=e,this._jobMiddlewares=[],this._adapterMap=new Map,this.use=t=>{this._jobMiddlewares.push(t)},this.unuse=t=>{this._jobMiddlewares=this._jobMiddlewares.filter(n=>n!==t)},this.registerAdapter=(t,n,i=0)=>{this._adapterMap.set(t,{adapter:n,priority:i})},this.unregisterAdapter=t=>{this._adapterMap.delete(t)},this._getDataByType=(t,n)=>{const i=t.getData(n);if(i)return i;const r=Array.from(t.files).filter(o=>o.type===n);return r||""},this._getSnapshotByPriority=async(t,n,i,r)=>{const o=Array.from(this._adapterMap.entries()).sort((l,a)=>a[1].priority-l[1].priority);for(const[l,{adapter:a}]of o){const c=t(l);if(!(Array.isArray(c)&&(c.length===0||!c.map(d=>d.type===l).reduce((d,h)=>d||h,!1)))&&c){const d=this._getJob();a.applyConfigs(d.adapterConfigs);const h={file:c,assets:d.assetsManager,blockVersions:n.workspace.meta.blockVersions,pageVersion:n.workspace.meta.pageVersion,workspaceVersion:n.workspace.meta.workspaceVersion,workspaceId:n.workspace.id,pageId:n.id},u=await a.toSliceSnapshot(h);if(u)return d.snapshotToSlice(u,n,i,r)}}return null},this.copy=async t=>this.copySlice(t),this.paste=async(t,n,i,r)=>{const o=t.clipboardData;if(o)try{const l=this.readFromClipboard(o),a=await this._getSnapshotByPriority(c=>l[c],n,i,r);return R(a),a}catch{return await this._getSnapshotByPriority(a=>this._getDataByType(o,a),n,i,r)}},this.pasteBlockSnapshot=async(t,n,i,r)=>this._getJob().snapshotToBlock(t,n,i,r),this.copySlice=async t=>{const n=Array.from(this._adapterMap.keys());await this.writeToClipboard(async i=>{const r={...i};return await Promise.all(n.map(async o=>{const l=await this._getClipboardItem(t,o);typeof l=="string"&&(r[o]=l)})),r})}}_getJob(){return new vn({middlewares:this._jobMiddlewares,workspace:this.std.workspace})}async _getClipboardItem(e,t){const n=this._getJob(),i=this._adapterMap.get(t);R(i);const{adapter:r}=i,o=await n.sliceToSnapshot(e);return r.applyConfigs(n.adapterConfigs),(await r.fromSliceSnapshot({snapshot:o,assets:n.assetsManager})).file}async writeToClipboard(e){const n=await e({"text/plain":"","text/html":"","image/png":""}),i=n["text/plain"],r=n["text/html"],o=n["image/png"];delete n["text/plain"],delete n["text/html"],delete n["image/png"];const a=`<div data-blocksuite-snapshot=${Me.compressToEncodedURIComponent(JSON.stringify(n))}>${r}</div>`,d={"text/html":new Blob([a],{type:"text/html"})};if(i.length>0){const h=new Blob([i],{type:"text/plain"});d["text/plain"]=h}if(o instanceof Blob)d["image/png"]=o;else if(o.length>0){const h=new Blob([o],{type:"image/png"});d["image/png"]=h}await navigator.clipboard.write([new ClipboardItem(d)])}readFromClipboard(e){const t=e.getData("text/html"),r=new DOMParser().parseFromString(t,"text/html").querySelector("[data-blocksuite-snapshot]");return R(r),JSON.parse(Me.decompressFromEncodedURIComponent(r.dataset.blocksuiteSnapshot))}}class Jt{constructor({path:e}){this.path=e}get blockId(){return A.id(this.path)}is(e){return this.type===e}get type(){return this.constructor.type}get group(){return this.constructor.group}static fromJSON(e){throw new Error("You must override this method")}}const Ln=C.object({path:C.array(C.string())});class Ut extends Jt{static{this.type="block"}static{this.group="note"}equals(e){return e instanceof Ut?A.equals(this.path,e.path):!1}toJSON(){return{type:"block",path:this.path}}static fromJSON(e){return Ln.parse(e),new Ut({path:e.path})}}const Bn=C.object({x:C.number(),y:C.number()});class Ft extends Jt{static{this.type="cursor"}static{this.group="edgeless"}constructor(e,t){super({path:[]}),this.x=e,this.y=t}equals(e){return e instanceof Ft?this.x===e.x&&this.y===e.y:!1}toJSON(){return{type:"cursor",x:this.x,y:this.y}}static fromJSON(e){return Bn.parse(e),new Ft(e.x,e.y)}}const Un=C.object({elements:C.array(C.string()),editing:C.boolean()});class jt extends Jt{static{this.type="surface"}static{this.group="edgeless"}constructor(e,t,n){super({path:e}),this.elements=t,this.editing=n}isEmpty(){return this.elements.length===0&&!this.editing}equals(e){return e instanceof jt?this.blockId===e.blockId&&this.elements.length===e.elements.length&&this.elements.every((t,n)=>t===e.elements[n])&&this.editing===e.editing:!1}toJSON(){return{type:"surface",path:this.path,elements:this.elements,editing:this.editing}}static fromJSON(e){return Un.parse(e),new jt(e.path,e.elements,e.editing)}}const Fn=C.object({from:C.object({path:C.array(C.string()),index:C.number(),length:C.number()}),to:C.object({path:C.array(C.string()),index:C.number(),length:C.number()}).nullable(),isReverse:C.boolean().optional()});class Vt extends Jt{static{this.type="text"}static{this.group="note"}constructor({from:e,to:t,isReverse:n}){super({path:e.path}),this.from=e,this.to=this._equalPoint(e,t)?null:t,this.isReverse=!!n}get start(){return this.isReverse?this.to??this.from:this.from}get end(){return this.isReverse?this.from:this.to??this.from}empty(){return!!this.to}_equalPoint(e,t){return e&&t?A.equals(e.path,t.path)&&e.index===t.index&&e.length===t.length:e===t}equals(e){return e instanceof Vt?A.equals(this.path,e.path)&&this._equalPoint(e.from,this.from)&&this._equalPoint(e.to,this.to):!1}toJSON(){return{type:"text",from:this.from,to:this.to,isReverse:this.isReverse}}static fromJSON(e){return Fn.parse(e),new Vt({from:e.from,to:e.to,isReverse:!!e.isReverse})}isCollapsed(){return this.to===null&&this.from.length===0}isInSameBlock(){return this.to===null||A.equals(this.from.path,this.to.path)}}class jn{constructor(e){this.std=e,this.disposables=new at,this._selectionConstructors={},this.slots={changed:new J,remoteChanged:new J},this._jsonToSelection=t=>{const n=this._selectionConstructors[t.type];if(!n)throw new Error(`Unknown selection type: ${t.type}`);return n.fromJSON(t)},this._itemAdded=t=>{t.stackItem.meta.set("selection-state",this.value)},this._itemPopped=t=>{const n=t.stackItem.meta.get("selection-state");n&&this.set(n)},this._setupDefaultSelections()}register(e){return[e].flat().forEach(t=>{this._selectionConstructors[t.type]=t}),this}get _store(){return this.std.workspace.awarenessStore}_setupDefaultSelections(){this.register([Vt,Ut,jt,Ft])}create(e,...t){const n=this._selectionConstructors[e];if(!n)throw new Error(`Unknown selection type: ${e}`);return new n(...t)}get value(){return this._store.getLocalSelection().map(e=>this._jsonToSelection(e))}fromJSON(e){const t=e.map(n=>this._jsonToSelection(n));return this.set(t)}set(e){this._store.setLocalSelection(e.map(t=>t.toJSON())),this.slots.changed.emit(e)}setGroup(e,t){const n=this.value.filter(i=>i.group!==e);this.set([...n,...t])}getGroup(e){return this.value.filter(t=>t.group===e)}update(e){const t=e(this.value);this.set(t)}clear(e){if(e){const t=this.value.filter(n=>!e.includes(n.type));this.set(t)}else this.set([])}find(e){return this.value.find(t=>t.is(e))}filter(e){return this.value.filter(t=>t.is(e))}get remoteSelections(){const e=new Map;return this._store.getStates().forEach((t,n)=>{if(n===this._store.awareness.clientID)return;const i=t.selection.map(r=>{try{return this._jsonToSelection(r)}catch(o){return console.error("Parse remote selection failed:",n,r,o),null}}).filter(r=>!!r);e.set(n,i)}),e}mount(){this.disposables.disposed&&(this.disposables=new at),this.std.page.history.on("stack-item-added",this._itemAdded),this.std.page.history.on("stack-item-popped",this._itemPopped),this.disposables.add(this._store.slots.update.on(({id:e})=>{e!==this._store.awareness.clientID&&this.slots.remoteChanged.emit(this.remoteSelections)}))}unmount(){this.std.page.history.off("stack-item-added",this._itemAdded),this.std.page.history.off("stack-item-popped",this._itemPopped),this.slots.changed.dispose(),this.disposables.dispose(),this.clear()}dispose(){Object.values(this.slots).forEach(e=>e.dispose()),this.disposables.dispose()}}class Vn{constructor(e){this.std=e,this._specs=new Map,this._services=new Map}dispose(){this._services.forEach(e=>{e.dispose(),e.unmounted()}),this._services.clear()}applySpecs(e){const t=this._specs,n=this._buildSpecMap(e);this._diffServices(t,n),this._specs=n}getView(e){const t=this._specs.get(e);return t?t.view:null}getService(e){return this._services.get(e)}_diffServices(e,t){e.forEach((n,i)=>{if(t.has(i)&&t.get(i)?.service===n.service)return;const r=this._services.get(i);r&&(r.dispose(),r.unmounted()),this._services.delete(i)}),t.forEach((n,i)=>{if(this._services.has(i)||!n.service)return;const r=new n.service({flavour:i,std:this.std});this._services.set(i,r),r.mounted()})}_buildSpecMap(e){const t=new Map;return e.forEach(n=>{t.set(n.schema.model.flavour,n)}),t}}const Hn={childList:!0,subtree:!0};class qn{constructor(e){this.std=e,this._cachedTree=null,this._cachedPath=new Map,this.viewSpec=new Set,this.getChildren=t=>{const n=this.fromPath(t);return n?n.children:[]},this.getNodeView=t=>{for(const[n,i]of this.viewSpec.entries()){const r=i.fromDOM(t);if(r)return{...r}}return null},this.calculatePath=t=>this._calculateNodeViewPath(t).map(i=>i.id),this._getViewSpec=t=>Array.from(this.viewSpec).find(n=>n.type===t),this._calculateNodeViewPath=t=>{if(this._cachedPath.has(t))return this._cachedPath.get(t);const n=this.std.host,i=(o,l)=>{if(!o||o===n)return l;const a=this.getNodeView(o);if(!a)return l;const c=this._getViewSpec(a.type);R(c);const d=c.toDOM(a).parentElement;return d?i(d,l.concat(a)):l},r=i(t,[]).reverse();return this._cachedPath.set(t,r),r},this.getNodeViewTree=()=>{if(this._cachedTree)return this._cachedTree;const t=r=>{const o=this.getNodeView(r);if(!o)throw new Error("nodeView not found");const l=this._getViewSpec(o.type);R(l);const a=l.getChildren(l.toDOM(o)).map(c=>t(c));return{...o,children:a}},n=this.std.host.firstElementChild;R(n);const i={id:"__root__",path:[],children:[t(n)]};return this._cachedTree=i,i},this.fromPath=t=>{const n=this.getNodeViewTree();return t.reduce((i,r)=>{if(!i)return null;const o=i.children.find(l=>l.id===r);return o||null},n)},this.walkThrough=(t,n=[])=>{const i=this.fromPath(n);R(i,`Invalid path to get node in view: ${n}`);const r=o=>(l,a)=>{t(l,a,o)!==!0&&l.children.forEach(r(l))};i.children.forEach(r(i))},this.getParent=t=>t.length===0?null:this.fromPath(A.parent(t)),this.findPrev=(t,n)=>{const i=l=>{const a=this.getParent(l);if(!a)return null;const c=this._indexOf(l,a);if(c===-1)return null;if(c===0){const d=this.getParent(A.parent(l));return d?{nodeView:a,parent:d,index:this._indexOf(A.parent(l),d)}:null}return{nodeView:a.children[c-1],parent:a,index:c-1}};let r=null;const o=l=>{const a=i(l);if(!a)return;const{nodeView:c,parent:d,index:h}=a;if(n(c,h,d)){r=c;return}o(c.path)};return o(t),r},this.findNext=(t,n)=>{const i=l=>{const a=this.getParent(l);if(!a)return null;const c=this._indexOf(l,a);if(c===-1)return null;if(c===a.children.length-1){const d=this.getParent(A.parent(l));return d?{nodeView:a,parent:d,index:this._indexOf(A.parent(l),d)}:null}return{nodeView:a.children[c+1],parent:a,index:c+1}};let r=null;const o=l=>{const a=i(l);if(!a)return;const{nodeView:c,parent:d,index:h}=a;if(n(c,h,d)){r=c;return}o(c.path)};return o(t),r},this.indexOf=t=>{const n=this.getParent(t);return n?this._indexOf(t,n):-1},this._indexOf=(t,n)=>n.children.findIndex(i=>i.id===t[t.length-1]),this._observer=new MutationObserver(()=>{this._cachedPath.clear(),this._cachedTree=null})}register(e){this.viewSpec.add(e)}viewFromPath(e,t){const n=this.fromPath(t);return!n||n.type!==e?null:n.view}mount(){this._observer.observe(this.std.host,Hn)}unmount(){this._cachedPath.clear(),this._cachedTree=null,this._observer.disconnect(),this.viewSpec.clear()}}class zn{constructor(e){this.host=e.host,this.workspace=e.workspace,this.page=e.page,this.event=new ot(this),this.selection=new jn(this),this.command=new bn(this),this.spec=new Vn(this),this.view=new qn(this),this.clipboard=new Nn(this)}mount(){this.selection.mount(),this.event.mount(),this.view.mount()}unmount(){this.event.unmount(),this.selection.unmount(),this.view.unmount(),this.spec.dispose()}}/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Lt=globalThis,ve=Lt.ShadowRoot&&(Lt.ShadyCSS===void 0||Lt.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,ye=Symbol(),Ne=new WeakMap;let we=class{constructor(e,t,n){if(this._$cssResult$=!0,n!==ye)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=e,this.t=t}get styleSheet(){let e=this.o;const t=this.t;if(ve&&e===void 0){const n=t!==void 0&&t.length===1;n&&(e=Ne.get(t)),e===void 0&&((this.o=e=new CSSStyleSheet).replaceSync(this.cssText),n&&Ne.set(t,e))}return e}toString(){return this.cssText}};const Kn=s=>new we(typeof s=="string"?s:s+"",void 0,ye),tr=(s,...e)=>{const t=s.length===1?s[0]:e.reduce((n,i,r)=>n+(o=>{if(o._$cssResult$===!0)return o.cssText;if(typeof o=="number")return o;throw Error("Value passed to 'css' function must be a 'css' function result: "+o+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(i)+s[r+1],s[0]);return new we(t,s,ye)},Wn=(s,e)=>{if(ve)s.adoptedStyleSheets=e.map(t=>t instanceof CSSStyleSheet?t:t.styleSheet);else for(const t of e){const n=document.createElement("style"),i=Lt.litNonce;i!==void 0&&n.setAttribute("nonce",i),n.textContent=t.cssText,s.appendChild(n)}},Le=ve?s=>s:s=>s instanceof CSSStyleSheet?(e=>{let t="";for(const n of e.cssRules)t+=n.cssText;return Kn(t)})(s):s;/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const{is:Yn,defineProperty:Xn,getOwnPropertyDescriptor:Gn,getOwnPropertyNames:Jn,getOwnPropertySymbols:Zn,getPrototypeOf:Qn}=Object,Zt=globalThis,Be=Zt.trustedTypes,ts=Be?Be.emptyScript:"",es=Zt.reactiveElementPolyfillSupport,At=(s,e)=>s,Ht={toAttribute(s,e){switch(e){case Boolean:s=s?ts:null;break;case Object:case Array:s=s==null?s:JSON.stringify(s)}return s},fromAttribute(s,e){let t=s;switch(e){case Boolean:t=s!==null;break;case Number:t=s===null?null:Number(s);break;case Object:case Array:try{t=JSON.parse(s)}catch{t=null}}return t}},xe=(s,e)=>!Yn(s,e),Ue={attribute:!0,type:String,converter:Ht,reflect:!1,hasChanged:xe};Symbol.metadata??=Symbol("metadata"),Zt.litPropertyMetadata??=new WeakMap;class ft extends HTMLElement{static addInitializer(e){this._$Ei(),(this.l??=[]).push(e)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(e,t=Ue){if(t.state&&(t.attribute=!1),this._$Ei(),this.elementProperties.set(e,t),!t.noAccessor){const n=Symbol(),i=this.getPropertyDescriptor(e,n,t);i!==void 0&&Xn(this.prototype,e,i)}}static getPropertyDescriptor(e,t,n){const{get:i,set:r}=Gn(this.prototype,e)??{get(){return this[t]},set(o){this[t]=o}};return{get(){return i?.call(this)},set(o){const l=i?.call(this);r.call(this,o),this.requestUpdate(e,l,n)},configurable:!0,enumerable:!0}}static getPropertyOptions(e){return this.elementProperties.get(e)??Ue}static _$Ei(){if(this.hasOwnProperty(At("elementProperties")))return;const e=Qn(this);e.finalize(),e.l!==void 0&&(this.l=[...e.l]),this.elementProperties=new Map(e.elementProperties)}static finalize(){if(this.hasOwnProperty(At("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(At("properties"))){const t=this.properties,n=[...Jn(t),...Zn(t)];for(const i of n)this.createProperty(i,t[i])}const e=this[Symbol.metadata];if(e!==null){const t=litPropertyMetadata.get(e);if(t!==void 0)for(const[n,i]of t)this.elementProperties.set(n,i)}this._$Eh=new Map;for(const[t,n]of this.elementProperties){const i=this._$Eu(t,n);i!==void 0&&this._$Eh.set(i,t)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(e){const t=[];if(Array.isArray(e)){const n=new Set(e.flat(1/0).reverse());for(const i of n)t.unshift(Le(i))}else e!==void 0&&t.push(Le(e));return t}static _$Eu(e,t){const n=t.attribute;return n===!1?void 0:typeof n=="string"?n:typeof e=="string"?e.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){this._$Eg=new Promise(e=>this.enableUpdating=e),this._$AL=new Map,this._$ES(),this.requestUpdate(),this.constructor.l?.forEach(e=>e(this))}addController(e){(this._$E_??=new Set).add(e),this.renderRoot!==void 0&&this.isConnected&&e.hostConnected?.()}removeController(e){this._$E_?.delete(e)}_$ES(){const e=new Map,t=this.constructor.elementProperties;for(const n of t.keys())this.hasOwnProperty(n)&&(e.set(n,this[n]),delete this[n]);e.size>0&&(this._$Ep=e)}createRenderRoot(){const e=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return Wn(e,this.constructor.elementStyles),e}connectedCallback(){this.renderRoot??=this.createRenderRoot(),this.enableUpdating(!0),this._$E_?.forEach(e=>e.hostConnected?.())}enableUpdating(e){}disconnectedCallback(){this._$E_?.forEach(e=>e.hostDisconnected?.())}attributeChangedCallback(e,t,n){this._$AK(e,n)}_$EO(e,t){const n=this.constructor.elementProperties.get(e),i=this.constructor._$Eu(e,n);if(i!==void 0&&n.reflect===!0){const r=(n.converter?.toAttribute!==void 0?n.converter:Ht).toAttribute(t,n.type);this._$Em=e,r==null?this.removeAttribute(i):this.setAttribute(i,r),this._$Em=null}}_$AK(e,t){const n=this.constructor,i=n._$Eh.get(e);if(i!==void 0&&this._$Em!==i){const r=n.getPropertyOptions(i),o=typeof r.converter=="function"?{fromAttribute:r.converter}:r.converter?.fromAttribute!==void 0?r.converter:Ht;this._$Em=i,this[i]=o.fromAttribute(t,r.type),this._$Em=null}}requestUpdate(e,t,n,i=!1,r){if(e!==void 0){if(n??=this.constructor.getPropertyOptions(e),!(n.hasChanged??xe)(i?r:this[e],t))return;this.C(e,t,n)}this.isUpdatePending===!1&&(this._$Eg=this._$EP())}C(e,t,n){this._$AL.has(e)||this._$AL.set(e,t),n.reflect===!0&&this._$Em!==e&&(this._$Ej??=new Set).add(e)}async _$EP(){this.isUpdatePending=!0;try{await this._$Eg}catch(t){Promise.reject(t)}const e=this.scheduleUpdate();return e!=null&&await e,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??=this.createRenderRoot(),this._$Ep){for(const[i,r]of this._$Ep)this[i]=r;this._$Ep=void 0}const n=this.constructor.elementProperties;if(n.size>0)for(const[i,r]of n)r.wrapped!==!0||this._$AL.has(i)||this[i]===void 0||this.C(i,this[i],r)}let e=!1;const t=this._$AL;try{e=this.shouldUpdate(t),e?(this.willUpdate(t),this._$E_?.forEach(n=>n.hostUpdate?.()),this.update(t)):this._$ET()}catch(n){throw e=!1,this._$ET(),n}e&&this._$AE(t)}willUpdate(e){}_$AE(e){this._$E_?.forEach(t=>t.hostUpdated?.()),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(e)),this.updated(e)}_$ET(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$Eg}shouldUpdate(e){return!0}update(e){this._$Ej&&=this._$Ej.forEach(t=>this._$EO(t,this[t])),this._$ET()}updated(e){}firstUpdated(e){}}ft.elementStyles=[],ft.shadowRootOptions={mode:"open"},ft[At("elementProperties")]=new Map,ft[At("finalized")]=new Map,es?.({ReactiveElement:ft}),(Zt.reactiveElementVersions??=[]).push("2.0.2");/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */let K=class extends ft{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){const e=super.createRenderRoot();return this.renderOptions.renderBefore??=e.firstChild,e}update(e){const t=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(e),this._$Do=Tt(t,this.renderRoot,this.renderOptions)}connectedCallback(){super.connectedCallback(),this._$Do?.setConnected(!0)}disconnectedCallback(){super.disconnectedCallback(),this._$Do?.setConnected(!1)}render(){return Gt}};K._$litElement$=!0,K.finalized=!0,globalThis.litElementHydrateSupport?.({LitElement:K});const ns=globalThis.litElementPolyfillSupport;ns?.({LitElement:K});(globalThis.litElementVersions??=[]).push("4.0.2");/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Qt=s=>(e,t)=>{t!==void 0?t.addInitializer(()=>{customElements.define(s,e)}):customElements.define(s,e)};/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const ss={attribute:!0,type:String,converter:Ht,reflect:!1,hasChanged:xe},is=(s=ss,e,t)=>{const{kind:n,metadata:i}=t;let r=globalThis.litPropertyMetadata.get(i);if(r===void 0&&globalThis.litPropertyMetadata.set(i,r=new Map),r.set(t.name,s),n==="accessor"){const{name:o}=t;return{set(l){const a=e.get.call(this);e.set.call(this,l),this.requestUpdate(o,a,s)},init(l){return l!==void 0&&this.C(o,void 0,s),l}}}if(n==="setter"){const{name:o}=t;return function(l){const a=this[o];e.call(this,l),this.requestUpdate(o,a,s)}}throw Error("Unsupported decorator location: "+n)};function P(s){return(e,t)=>typeof t=="object"?is(s,e,t):((n,i,r)=>{const o=i.hasOwnProperty(r);return i.constructor.createProperty(r,o?{...n,wrapped:!0}:n),o?Object.getOwnPropertyDescriptor(i,r):void 0})(s,e,t)}/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function rs(s){return P({...s,state:!0,attribute:!1})}/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const ue=(s,e,t)=>(t.configurable=!0,t.enumerable=!0,Reflect.decorate&&typeof e!="object"&&Object.defineProperty(s,e,t),t);/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function nr(s,e){return(t,n,i)=>{const r=o=>o.renderRoot?.querySelector(s)??null;if(e){const{get:o,set:l}=typeof n=="object"?t:i??(()=>{const a=Symbol();return{get(){return this[a]},set(c){this[a]=c}}})();return ue(t,n,{get(){let a=o.call(this);return a===void 0&&(a=r(this),(a!==null||this.hasUpdated)&&l.call(this,a)),a}})}return ue(t,n,{get(){return r(this)}})}}/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function sr(s){return(e,t)=>ue(e,t,{async get(){return await this.updateComplete,this.renderRoot?.querySelector(s)??null}})}/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const te={ATTRIBUTE:1,CHILD:2,PROPERTY:3,BOOLEAN_ATTRIBUTE:4,EVENT:5,ELEMENT:6},ee=s=>(...e)=>({_$litDirective$:s,values:e});let ne=class{constructor(e){}get _$AU(){return this._$AM._$AU}_$AT(e,t,n){this._$Ct=e,this._$AM=t,this._$Ci=n}_$AS(e,t){return this.update(e,t)}update(e,t){return this.render(...t)}};/**
 * @license
 * Copyright 2018 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const en="important",os=" !"+en,wt=ee(class extends ne{constructor(s){if(super(s),s.type!==te.ATTRIBUTE||s.name!=="style"||s.strings?.length>2)throw Error("The `styleMap` directive must be used in the `style` attribute and must be the only part in the attribute.")}render(s){return Object.keys(s).reduce((e,t)=>{const n=s[t];return n==null?e:e+`${t=t.includes("-")?t:t.replace(/(?:^(webkit|moz|ms|o)|)(?=[A-Z])/g,"-$&").toLowerCase()}:${n};`},"")}update(s,[e]){const{style:t}=s.element;if(this.ut===void 0)return this.ut=new Set(Object.keys(e)),this.render(e);for(const n of this.ut)e[n]==null&&(this.ut.delete(n),n.includes("-")?t.removeProperty(n):t[n]=null);for(const n in e){const i=e[n];if(i!=null){this.ut.add(n);const r=typeof i=="string"&&i.endsWith(os);n.includes("-")||r?t.setProperty(n,r?i.slice(0,-11):i,r?en:""):t[n]=i}}return Gt}}),xt="​",rr="‌",lt="data-v-root";function pt(s){const e=s.rootElement;if(!e)throw new Error("editor root element not found");const t=e.getRootNode();return(t instanceof Document||t instanceof ShadowRoot)&&"getSelection"in t?t:e.ownerDocument}function as(s){const e=s.closest(`[${lt}]`);R(e,"element must be inside a v-root");const t=e.inlineEditor;return R(t,"element must be inside a v-root with inline-editor"),t}var ls=Object.defineProperty,cs=Object.getOwnPropertyDescriptor,be=(s,e,t,n)=>{for(var i=n>1?void 0:n?cs(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&ls(e,t,i),i};let ct=class extends K{constructor(){super(...arguments),this.delta={insert:xt}}render(){const s=as(this),e=s.attributeService.attributeRenderer;if(s.isEmbed(this.delta)){if(this.delta.insert.length!==1)throw new Error(`The length of embed node should only be 1.
          This seems to be an internal issue with inline editor.
          Please go to https://github.com/toeverything/blocksuite/issues
          to report it.`);return Y`<span
        data-v-embed="true"
        data-v-element="true"
        contenteditable="false"
        style=${wt({userSelect:"none"})}
        >${e(this.delta,this.selected)}</span
      >`}return Y`<span data-v-element="true"
      >${e(this.delta,this.selected)}</span
    >`}createRenderRoot(){return this}};be([P({type:Object})],ct.prototype,"delta",2);be([P({attribute:!1})],ct.prototype,"selected",2);ct=be([Qt("v-element")],ct);const Mt=Y`<span
  data-v-embed-gap="true"
  style=${wt({userSelect:"text",padding:"0 0.5px",outline:"none"})}
  ><v-text></v-text
></span>`;var hs=Object.defineProperty,ds=Object.getOwnPropertyDescriptor,nn=(s,e,t,n)=>{for(var i=n>1?void 0:n?ds(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&hs(e,t,i),i};let $t=class extends K{constructor(){super(...arguments),this.elements=[]}get vElements(){return Array.from(this.querySelectorAll("v-element"))}get vTexts(){return Array.from(this.querySelectorAll("v-text"))}get textLength(){return this.vElements.reduce((s,e)=>s+e.delta.insert.length,0)}get textContent(){return this.vElements.reduce((s,e)=>s+e.delta.insert,"")}async getUpdateComplete(){const s=await super.getUpdateComplete();return await Promise.all(this.vElements.map(e=>e.updateComplete)),await Promise.all(this.vTexts.map(e=>e.updateComplete)),s}firstUpdated(){this.style.display="block"}render(){if(this.elements.length===0)return Y`<div><v-text .str=${xt}></v-text></div>`;if(!this.isConnected)return;const s=this.closest(`[${lt}]`);R(s,"v-line must be inside a v-root");const e=s.inlineEditor;R(e,"v-line must be inside a v-root with inline-editor");const t=this.elements.flatMap(([n,i],r)=>{if(e.isEmbed(i)){if(i.insert.length!==1)throw new Error(`The length of embed node should only be 1.
            This seems to be an internal issue with inline editor.
            Please go to https://github.com/toeverything/blocksuite/issues
            to report it.`);if(r===0){const o=this.elements[r+1]?.[1];return!o||e.isEmbed(o)?[Mt,n,Mt]:[Mt,n]}else{const o=this.elements[r+1]?.[1];return!o||e.isEmbed(o)?[n,Mt]:[n]}}return n});return Y`<div style=${wt({padding:"0 0.5px"})}>${t}</div>`}createRenderRoot(){return this}};nn([P({attribute:!1})],$t.prototype,"elements",2);$t=nn([Qt("v-line")],$t);var us=Object.defineProperty,fs=Object.getOwnPropertyDescriptor,Ee=(s,e,t,n)=>{for(var i=n>1?void 0:n?fs(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&us(e,t,i),i};let qt=class extends K{constructor(){super(...arguments),this.str=xt,this.styles={"word-wrap":"break-word","white-space":"break-spaces"}}render(){return Y`<span style=${wt(this.styles)} data-v-text="true"
      >${this.str}</span
    >`}createRenderRoot(){return this}};Ee([P({attribute:!1})],qt.prototype,"str",2);Ee([P({attribute:!1})],qt.prototype,"styles",2);qt=Ee([Qt("v-text")],qt);class ps{constructor(e,t={}){this.editor=e,this.hooks=t}}function gs(s){let e="";s.underline&&(e+="underline"),s.strike&&(e+=" line-through");let t={};return s.code&&(t={"font-family":'"SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace',"line-height":"normal",background:"rgba(135,131,120,0.15)",color:"#EB5757","border-radius":"3px","font-size":"85%",padding:"0.2em 0.4em"}),wt({"word-wrap":"break-word","white-space":"break-spaces","font-weight":s.bold?"bold":"normal","font-style":s.italic?"italic":"normal","text-decoration":e.length>0?e:"none",...t})}const ms=()=>s=>{const e=s.attributes?gs(s.attributes):wt({});return Y`<span style=${e}
      ><v-text .str=${s.insert}></v-text
    ></span>`},_s=C.object({bold:C.literal(!0).optional().nullable().catch(void 0),italic:C.literal(!0).optional().nullable().catch(void 0),underline:C.literal(!0).optional().nullable().catch(void 0),strike:C.literal(!0).optional().nullable().catch(void 0),code:C.literal(!0).optional().nullable().catch(void 0),link:C.string().optional().nullable().catch(void 0)});function vs(s){const e=[];let t=s.insert;for(;t.length>0;){const n=t.indexOf(`
`);if(n===-1){e.push({insert:t,attributes:s.attributes});break}t.slice(0,n).length>0&&e.push({insert:t.slice(0,n),attributes:s.attributes}),e.push(`
`),t=t.slice(n+1)}return e}function ys(s){if(s.length===0)return[[]];const e=s.flatMap(vs);function*t(n){let i=0;for(let r=0;r<n.length;r++)if(n[r]===`
`){const o=n.slice(i,r);i=r+1,yield o}else r===n.length-1&&(yield n.slice(i));n.at(-1)===`
`&&(yield[])}return Array.from(t(e))}function zt(s){return s instanceof Element?s instanceof ct?s.querySelector('[data-v-embed="true"]')!==null:!!s.closest('[data-v-embed="true"]'):!!s.parentElement?.closest('[data-v-embed="true"]')}function Fe(s,e){const t=[];for(const n of e)if(s.isEmbed(n)){const i=[...n.insert].map(r=>({insert:r,attributes:n.attributes}));t.push(...i)}else t.push(n);return t}function ws(s){return s instanceof Text&&s.parentElement?.dataset.vText==="true"}function xs(s){return s instanceof HTMLElement&&(s.dataset.vElement==="true"||s instanceof ct)}function bs(s){return s instanceof HTMLElement&&(s instanceof $t||s.parentElement instanceof $t)}function Es(s){return s instanceof HTMLElement&&s.dataset.vRoot==="true"}const Ss=yn||wn?"metaKey":"ctrlKey",Rs=!1,or=!0;function ar(s,e){const t={};function n(l){return l.shortKey&&(l[Ss]=l.shortKey,delete l.shortKey),l}function i(l,a){return["altKey","ctrlKey","metaKey","shiftKey"].some(c=>Object.hasOwn(a,c)&&a[c]!==l[c])?!1:a.key===l.key}function r(l){const a=n(l);(Array.isArray(a.key)?a.key:[a.key]).forEach(d=>{const h={...a,key:d};t[d]=t[d]??[],t[d].push(h)})}Object.values(e).forEach(l=>{r(l)});function o(l){if(l.defaultPrevented||l.isComposing)return;const c=(t[l.key]??[]).filter(v=>i(l,v));if(c.length===0)return;const d=s.getInlineRange();if(!d)return;const[h,u]=s.getTextPoint(d.index),[f,p]=d.length===0?[h,u]:s.getTextPoint(d.index+d.length),_=h.textContent?h.textContent.slice(0,u):"",w=f.textContent?f.textContent.slice(p):"",m={inlineRange:d,inlineEditor:s,collapsed:d.length===0,prefixText:_,suffixText:w,raw:l};c.some(v=>v.prefix&&!v.prefix.test(m.prefixText)||v.suffix&&!v.suffix.test(m.suffixText)?!1:v.handler(m)===Rs)&&l.preventDefault()}return o}function Pt(s){return s.wholeText===xt?0:s.wholeText.length}function W(s){return Array.from(s.querySelectorAll('[data-v-text="true"]')).map(n=>{const i=Array.from(n.childNodes).find(r=>r instanceof Text);if(!i)throw new Error("text node not found");return i})}function fe(s,e){if(ws(s))return[s,e];if(xs(s)){const n=W(s);if(n.length===1){const i=n[0].parentElement?.closest('[data-v-element="true"]');if(i instanceof HTMLElement&&i.dataset.vEmbed==="true")return[n[0],0]}return n[e]?[n[e],0]:null}if(bs(s)||Es(s))return pe(s,e,!0);if(!(s instanceof Node))return null;const t=Cs(s);return t?Ts(t,s,e):null}function mt(s,e,t){if(t.dataset.vRoot!=="true")throw new Error("textRangeToDomPoint should be called with editor root element");if(!t.contains(s))return null;const n=W(t),i=n.indexOf(s);let r=0;for(const c of n.slice(0,i))r+=Pt(c);s.wholeText!==xt&&(r+=e);const o=s.parentElement;if(!o)throw new Error("text element parent not found");const l=o.closest("v-line");if(!l)throw new Error("line element not found");const a=Array.from(t.querySelectorAll("v-line")).indexOf(l);return{text:s,index:r+a}}function Cs(s){const e=s.parentElement?.closest("v-line");if(e)return Array.from(e.querySelectorAll("v-element"));const t=s instanceof Element?s.closest(`[${lt}]`):s.parentElement?.closest(`[${lt}]`);return t?Array.from(t.querySelectorAll("v-line")):null}function Ts(s,e,t){const n=s[0];for(let i=0;i<s.length;i++){const r=s[i];if(i===0&&Ve(e,r))return pe(n,t,!0);if(As(e,r))return pe(n,t,!1);if(i===s.length-1&&He(e,r)||i<s.length-1&&He(e,r)&&Ve(e,s[i+1]))return je(r)}return null}function je(s){const e=W(s);if(e.length===0)return null;const t=e[e.length-1];return[t,Pt(t)]}function pe(s,e,t){const n=W(s);if(n.length===0)return null;const i=t?n[0]:n[n.length-1];return[i,e===0?e:i.length]}function As(s,e){return e.compareDocumentPosition(s)===Node.DOCUMENT_POSITION_CONTAINED_BY||e.compareDocumentPosition(s)===(Node.DOCUMENT_POSITION_CONTAINED_BY|Node.DOCUMENT_POSITION_FOLLOWING)}function Ve(s,e){return s.compareDocumentPosition(e)===Node.DOCUMENT_POSITION_FOLLOWING}function He(s,e){return s.compareDocumentPosition(e)===Node.DOCUMENT_POSITION_PRECEDING}const Os=({rootElement:s,startText:e,endText:t})=>s.contains(e)&&s.contains(t),$s=({rootElement:s,startText:e,endText:t,startTextOffset:n,endTextOffset:i})=>{const r=mt(e,n,s),o=mt(t,i,s);return!r||!o?null:{index:Math.min(r.index,o.index),length:Math.abs(r.index-o.index)}},Ps=({rootElement:s,startText:e,endText:t})=>!s.contains(e)&&s.contains(t),ks=({rootElement:s,endText:e,endTextOffset:t})=>{const n=mt(e,t,s);return n?{index:0,length:n.index}:null},Ds=({rootElement:s,startText:e,endText:t})=>s.contains(e)&&!s.contains(t),Is=({yText:s,rootElement:e,startText:t,startTextOffset:n})=>{const i=mt(t,n,e);return i?{index:i.index,length:s.length-i.index}:null},Ms=({rootElement:s,startText:e,endText:t,range:n})=>!s.contains(e)&&!s.contains(t)&&n.intersectsNode(s),Ns=({yText:s})=>({index:0,length:s.length}),Ls=(s,e,t)=>{const{startContainer:n,startOffset:i,endContainer:r,endOffset:o}=s,l=fe(n,i),a=fe(r,o);if(!l||!a)return null;const[c,d]=l,[h,u]=a;return{rootElement:e,range:s,yText:t,startNode:n,startOffset:i,endNode:r,endOffset:o,startText:c,startTextOffset:d,endText:h,endTextOffset:u}};function Bs(s,e,t){const n=Ls(s,e,t);if(!n)return null;if(n.startNode&&n.startNode===n.endNode&&zt(n.startNode)){const i=mt(n.startText,n.startTextOffset,e);if(i)return{index:i.index,length:1}}return Os(n)?$s(n):Ps(n)?ks(n):Ds(n)?Is(n):Ms(n)?Ns(n):null}function Us(s,e){const t=Array.from(s.querySelectorAll("v-line"));let n=null,i=null,r=0,o=0,l=0;for(let c=0;c<t.length&&!(n&&i);c++){const d=W(t[c]);for(const h of d){const u=Pt(h);if(!n&&l+u>=e.index&&(n=h,r=e.index-l),!i&&l+u>=e.index+e.length&&(i=h,o=e.index+e.length-l),n&&i)break;l+=u}l+=1}if(!n||!i)return null;if(zt(n)){const c=n.parentElement?.closest("v-element");if(!c)throw new Error("failed to find vElement for a text note in an embed element");const d=c.nextElementSibling;if(!d)throw new Error("failed to find nextSibling sibling of an embed element");const h=W(d);d instanceof ct?(n=h[h.length-1],r=Pt(n)):(n=h[0],r=0)}if(zt(i)){const c=i.parentElement?.closest("v-element");if(!c)throw new Error("failed to find vElement for a text note in an embed element");const d=c.nextElementSibling;if(!d)throw new Error("failed to find nextSibling sibling of an embed element");i=W(d)[0],o=0}const a=document.createRange();return a.setStart(n,r),a.setEnd(i,o),a}function Fs(s,e,t){return Y`<v-element
    .selected=${t}
    .delta=${{insert:s.insert,attributes:e(s.attributes)}}
  ></v-element>`}function js(s,e,t,n){e&&(t.insertText(s,e,n),t.setInlineRange({index:s.index+e.length,length:0}))}function Vs(s,e){e.insertLineBreak(s),e.setInlineRange({index:s.index+1,length:0})}function Hs(s,e){e.deleteText(s),e.setInlineRange({index:s.index,length:0})}function qs(s,e,t,n,i){if(i.isValidInlineRange(n))if(s==="insertText")js(n,e,i,t);else if(s==="insertParagraph"||s==="insertLineBreak")Vs(n,i);else if(s.startsWith("delete"))Hs(n,i);else return}class zs{constructor(e){this.editor=e,this._marks=null,this._attributeRenderer=ms(),this._attributeSchema=_s,this.setMarks=t=>{this._marks=t},this.resetMarks=()=>{this._marks=null},this.setAttributeSchema=t=>{this._attributeSchema=t},this.setAttributeRenderer=t=>{this._attributeRenderer=t},this.getFormat=(t,n=!1)=>{const r=this.editor.deltaService.getDeltasByInlineRange(t).filter(([l,a])=>a.index+a.length>t.index&&a.index<=t.index+t.length).map(([l])=>l.attributes);return n?r.reduce((l,a)=>({...l,...a}),{}):!r.length||r.some(l=>!l)?{}:r.reduce((l,a)=>{const c={};for(const d in l){const h=d;l[h]===a[h]&&(c[h]=l[h])}return c})},this.normalizeAttributes=t=>{if(!t)return;const n=this._attributeSchema.safeParse(t);if(!n.success){console.error(n.error);return}return Object.fromEntries(Object.entries(n.data).filter(([i,r])=>r||r===null))}}get marks(){return this._marks}get attributeRenderer(){return this._attributeRenderer}}/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const{D:Ks}=xn,lr=(s,e)=>e===void 0?s?._$litType$!==void 0:s?._$litType$===e,Ws=s=>s.strings===void 0,qe=()=>document.createComment(""),Ct=(s,e,t)=>{const n=s._$AA.parentNode,i=e===void 0?s._$AB:e._$AA;if(t===void 0){const r=n.insertBefore(qe(),i),o=n.insertBefore(qe(),i);t=new Ks(r,o,s,s.options)}else{const r=t._$AB.nextSibling,o=t._$AM,l=o!==s;if(l){let a;t._$AQ?.(s),t._$AM=s,t._$AP!==void 0&&(a=s._$AU)!==o._$AU&&t._$AP(a)}if(r!==i||l){let a=t._$AA;for(;a!==r;){const c=a.nextSibling;n.insertBefore(a,i),a=c}}}return t},rt=(s,e,t=s)=>(s._$AI(e,t),s),Ys={},Xs=(s,e=Ys)=>s._$AH=e,Gs=s=>s._$AH,he=s=>{s._$AP?.(!1,!0);let e=s._$AA;const t=s._$AB.nextSibling;for(;e!==t;){const n=e.nextSibling;e.remove(),e=n}};/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const ze=(s,e,t)=>{const n=new Map;for(let i=e;i<=t;i++)n.set(s[i],i);return n},sn=ee(class extends ne{constructor(s){if(super(s),s.type!==te.CHILD)throw Error("repeat() can only be used in text expressions")}ht(s,e,t){let n;t===void 0?t=e:e!==void 0&&(n=e);const i=[],r=[];let o=0;for(const l of s)i[o]=n?n(l,o):o,r[o]=t(l,o),o++;return{values:r,keys:i}}render(s,e,t){return this.ht(s,e,t).values}update(s,[e,t,n]){const i=Gs(s),{values:r,keys:o}=this.ht(e,t,n);if(!Array.isArray(i))return this.dt=o,r;const l=this.dt??=[],a=[];let c,d,h=0,u=i.length-1,f=0,p=r.length-1;for(;h<=u&&f<=p;)if(i[h]===null)h++;else if(i[u]===null)u--;else if(l[h]===o[f])a[f]=rt(i[h],r[f]),h++,f++;else if(l[u]===o[p])a[p]=rt(i[u],r[p]),u--,p--;else if(l[h]===o[p])a[p]=rt(i[h],r[p]),Ct(s,a[p+1],i[h]),h++,p--;else if(l[u]===o[f])a[f]=rt(i[u],r[f]),Ct(s,i[h],i[u]),u--,f++;else if(c===void 0&&(c=ze(o,f,p),d=ze(l,h,u)),c.has(l[h]))if(c.has(l[u])){const _=d.get(o[f]),w=_!==void 0?i[_]:null;if(w===null){const m=Ct(s,i[h]);rt(m,r[f]),a[f]=m}else a[f]=rt(w,r[f]),Ct(s,i[h],w),i[_]=null;f++}else he(i[u]),u--;else he(i[h]),h++;for(;f<=p;){const _=Ct(s,a[p+1]);rt(_,r[f]),a[f++]=_}for(;h<=u;){const _=i[h++];_!==null&&he(_)}return this.dt=o,Xs(s,a),Gt}});class Js{constructor(e){this.editor=e,this.mapDeltasInInlineRange=(t,n,i=!1)=>{const r=i?Fe(this.editor,this.deltas):this.deltas,o=[];return r.reduce((l,a,c)=>{const d=a.insert.length,h=t.index-d,u=t.index+t.length;if(l>=h&&(l<u||t.length===0&&l===t.index)){const p=n(a,l,c);o.push(p)}return l+d},0),o},this.getDeltaByRangeIndex=t=>{const n=this.deltas;let i=0;for(const r of n){if(i+r.insert.length>=t)return r;i+=r.insert.length}return null},this.getDeltasByInlineRange=t=>this.mapDeltasInInlineRange(t,(n,i)=>[n,{index:i,length:n.insert.length}]),this.render=async(t=!0)=>{if(!this.editor.mounted)return;this.editor.slots.render.emit();const n=this.editor.rootElement,i=Fe(this.editor,this.deltas),r=ys(i);let o=0;const l=r.map(a=>{if(a.length>0){const c=[];a.forEach(h=>{c.push([h,o]),o++});const d=c.map(([h,u])=>{let f=!1;const p=this.editor.getInlineRange();return p&&(f=this.isNormalizedDeltaSelected(u,p)),[Fs(h,this.editor.attributeService.normalizeAttributes,f),h]});return Y`<v-line .elements=${d}></v-line>`}else return Y`<v-line .elements=${[]}></v-line>`});try{Tt(sn(l.map((a,c)=>({line:a,index:c})),a=>a.index,a=>a.line),n)}catch{this.editor.rerenderWholeEditor(),await this.editor.waitForUpdate()}await this.editor.waitForUpdate(),t&&this.editor.rangeService.syncInlineRange(),this.editor.slots.renderComplete.emit()}}get deltas(){return this.editor.yText.toDelta()}isNormalizedDeltaSelected(e,t){let n=!1;return t.length>=1&&this.editor.mapDeltasInInlineRange(t,(i,r,o)=>{o===e&&r>=t.index&&(n=!0)},!0),n}}function ge(s,e){return s===e||(s&&e?Zs(s,e):!1)}function Zs(s,e){return s.index===e.index&&s.length===e.length}function Qs(s,e){return s.index<=e.index+e.length&&s.index+s.length>=e.index}function ti(s,e){if(!Qs(s,e))return null;const t=Math.max(s.index,e.index),n=Math.min(s.index+s.length,e.index+e.length)-t;return{index:t,length:n}}class ei{constructor(e){this.editor=e,this._isComposing=!1,this._previousAnchor=null,this._previousFocus=null,this.mount=()=>{const t=this.editor.eventSource,n=this.editor.rootElement;this.inlineRangeProvider||this.editor.disposables.addFromEvent(document,"selectionchange",this._onSelectionChange),this.editor.disposables.addFromEvent(t,"beforeinput",this._onBeforeInput),this.editor.disposables.addFromEvent(t,"compositionstart",this._onCompositionStart),this.editor.disposables.addFromEvent(t,"compositionend",i=>{this._onCompositionEnd(i).catch(console.error)}),this.editor.disposables.addFromEvent(t,"keydown",this._onKeyDown),this.editor.disposables.addFromEvent(n,"click",this._onClick)},this._isRangeCompletelyInRoot=()=>{const n=pt(this.editor).getSelection();if(!n||n.rangeCount===0)return!1;const i=n.getRangeAt(0),r=this.editor.rootElement,o=document.createRange();return o.selectNode(r),i.startContainer.compareDocumentPosition(i.endContainer)&Node.DOCUMENT_POSITION_FOLLOWING?o.comparePoint(i.startContainer,i.startOffset)>=0&&o.comparePoint(i.endContainer,i.endOffset)<=0:o.comparePoint(i.endContainer,i.startOffset)>=0&&o.comparePoint(i.startContainer,i.endOffset)<=0},this._onSelectionChange=()=>{const t=this.editor.rootElement,n=this.editor.getInlineRange();if(this._isComposing)return;const r=pt(this.editor).getSelection();if(!r)return;if(r.rangeCount===0){n!==null&&this.editor.setInlineRange(null,!1);return}const o=r.getRangeAt(0);if(o.startContainer===o.endContainer&&o.startContainer.textContent===xt&&o.startOffset===1){o.setStart(o.startContainer,0),o.setEnd(o.endContainer,0),r.removeAllRanges(),r.addRange(o);return}if(!o.intersectsNode(t))if(o.endContainer.contains(t)&&Array.from(o.endContainer.childNodes).filter(c=>c instanceof HTMLElement).length===1&&o.startContainer.contains(t)&&Array.from(o.startContainer.childNodes).filter(c=>c instanceof HTMLElement).length===1){this.editor.focusEnd();return}else{n!==null&&this.editor.setInlineRange(null,!1);return}this._previousAnchor=[o.startContainer,o.startOffset],this._previousFocus=[o.endContainer,o.endOffset];const l=this.editor.toInlineRange(r.getRangeAt(0));ge(n,l)||this.editor.setInlineRange(l,!1),((o.startContainer.nodeType!==Node.TEXT_NODE||o.endContainer.nodeType!==Node.TEXT_NODE)&&o.startContainer!==this._previousAnchor[0]&&o.endContainer!==this._previousFocus[0]&&o.startOffset!==this._previousAnchor[1]&&o.endOffset!==this._previousFocus[1]||o.startContainer.nodeType===Node.COMMENT_NODE||o.endContainer.nodeType===Node.COMMENT_NODE)&&this.editor.syncInlineRange()},this._onCompositionStart=()=>{this._isComposing=!0,this.editor.rootElement.querySelectorAll('[data-v-embed="true"]').forEach(n=>{n.removeAttribute("contenteditable")})},this._onCompositionEnd=async t=>{if(this._isComposing=!1,!this.editor.rootElement.isConnected||(this.editor.rerenderWholeEditor(),await this.editor.waitForUpdate(),this.editor.isReadonly||!this._isRangeCompletelyInRoot()))return;const n=this.editor.getInlineRange();if(!n)return;let i={inlineEditor:this.editor,raw:t,inlineRange:n,data:t.data,attributes:{}};const r=this.editor.hooks.compositionEnd;if(r&&(i=r(i)),!i)return;const{inlineRange:o,data:l}=i;if(o.index>=0){const a=window.getSelection();if(a&&a.rangeCount!==0){const d=a.getRangeAt(0).startContainer;if(d instanceof Text){if(d.parentElement?.dataset.vText!=="true")d.remove();else{const[u]=this.editor.getTextPoint(o.index),f=u.parentElement?.closest("v-text");if(f)f.str!==u.textContent&&(u.textContent=f.str);else{const p=u.parentElement?.closest('[data-v-text="true"]');if(p instanceof HTMLElement)if(p.dataset.vTextValue)p.dataset.vTextValue!==u.textContent&&(u.textContent=p.dataset.vTextValue);else throw new Error("We detect a forged v-text node but it has no data-v-text-value attribute.")}}const h=this.editor.toDomRange(o);h&&(R(h),a.removeAllRanges(),a.addRange(h))}}l&&l.length>0&&(this.editor.insertText(o,l,i.attributes),this.editor.setInlineRange({index:o.index+l.length,length:0},!1))}},this._onBeforeInput=t=>{if(t.preventDefault(),this.editor.isReadonly||this._isComposing||!this._isRangeCompletelyInRoot()||!this.editor.getInlineRange())return;const n=t.getTargetRanges();if(n.length>0){const d=n[0],h=document.createRange();h.setStart(d.startContainer,d.startOffset),h.setEnd(d.endContainer,d.endOffset);const u=this.editor.toInlineRange(h);ge(this.editor.getInlineRange(),u)||this.editor.setInlineRange(u,!1)}const i=this.editor.getInlineRange();if(!i)return;let r={inlineEditor:this.editor,raw:t,inlineRange:i,data:t.data,attributes:{}};const o=this.editor.hooks.beforeinput;if(o&&(r=o(r)),!r)return;const{raw:l,data:a,inlineRange:c}=r;qs(l.inputType,a,r.attributes,c,this.editor)},this._onKeyDown=t=>{if(!t.shiftKey&&(t.key==="ArrowLeft"||t.key==="ArrowRight")){const n=this.editor.getInlineRange();if(!n||n.length!==0)return;const i=()=>{t.preventDefault(),t.stopPropagation()},r=this.editor.getDeltasByInlineRange(n);if(r.length===2)t.key==="ArrowLeft"&&this.editor.isEmbed(r[0][0])?(i(),this.editor.setInlineRange({index:n.index-1,length:1})):t.key==="ArrowRight"&&this.editor.isEmbed(r[1][0])&&(i(),this.editor.setInlineRange({index:n.index,length:1}));else if(r.length===1){const o=r[0][0];this.editor.isEmbed(o)&&(t.key==="ArrowLeft"&&n.index-1>=0?(i(),this.editor.setInlineRange({index:n.index-1,length:1})):t.key==="ArrowRight"&&n.index+1<=this.editor.yTextLength&&(i(),this.editor.setInlineRange({index:n.index,length:1})))}}},this._onClick=t=>{if(t.target instanceof Node&&zt(t.target)){const i=pt(this.editor).getSelection();if(!i)return;if(t.target instanceof HTMLElement){const r=t.target.closest("v-element");r&&i.selectAllChildren(r)}else{const r=t.target.parentElement?.closest("v-element");r&&i.selectAllChildren(r)}}}}get isComposing(){return this._isComposing}get inlineRangeProvider(){return this.editor.inlineRangeProvider}}class ni{constructor(e){this.editor=e,this._inlineRange=null,this.onInlineRangeUpdated=async([t,n])=>{if(ge(this._inlineRange,t)||(this._inlineRange=t,this.editor.mounted&&(await this.editor.waitForUpdate(),this.editor.requestUpdate(!1)),!n))return;if(this._inlineRange===null){const l=pt(this.editor).getSelection();l&&l.rangeCount>0&&l.getRangeAt(0).intersectsNode(this.editor.rootElement)&&l.removeAllRanges();return}requestAnimationFrame(()=>{this.syncInlineRange()})},this.getInlineRange=()=>this.inlineRangeProvider?this.inlineRangeProvider.getInlineRange():this._inlineRange,this.getInlineRangeFromElement=t=>{const n=document.createRange(),i=t.querySelector("[data-v-text");if(!i)return null;const r=i.childNodes[1];return R(r instanceof Text),n.setStart(r,0),n.setEnd(r,r.textContent?.length??0),this.toInlineRange(n)},this.isValidInlineRange=t=>!(t&&(t.index<0||t.index+t.length>this.editor.yText.length)),this.isFirstLine=t=>{if(!t)return!1;if(t.length>0)throw new Error("Inline range should be collapsed");const n=this.toDomRange(t);if(!n)throw new Error("failed to convert inline range to domRange");if(this.editor.yTextString.slice(0,t.index).includes(`
`))return!1;const r=n.commonAncestorContainer.parentElement;R(r);const o=r.getBoundingClientRect(),l=n.getClientRects();return l[l.length-1].top===o.top},this.isLastLine=t=>{if(!t)return!1;if(t.length>0)throw new Error("Inline range should be collapsed");if(this.editor.yTextString.slice(t.index).includes(`
`))return!1;const i=this.toDomRange(t);if(!i)throw new Error("failed to convert inline range to domRange");const r=i.commonAncestorContainer.parentElement;R(r);const o=r.getBoundingClientRect(),l=i.getClientRects();return l[l.length-1].bottom===o.bottom},this.setInlineRange=(t,n=!0)=>{if(!this.isValidInlineRange(t))throw new Error("invalid inline range");if(this.inlineRangeProvider){this.inlineRangeProvider.setInlineRange(t,n);return}this.editor.slots.inlineRangeUpdate.emit([t,n])},this.focusEnd=()=>{this.setInlineRange({index:this.editor.yTextLength,length:0})},this.focusStart=()=>{this.setInlineRange({index:0,length:0})},this.selectAll=()=>{this.setInlineRange({index:0,length:this.editor.yTextLength})},this.focusIndex=t=>{this.setInlineRange({index:t,length:0})},this.syncInlineRange=()=>{const t=this.getInlineRange();t&&this.editor.mounted&&this._applyInlineRange(t)},this.toDomRange=t=>{const n=this.editor.rootElement;return Us(n,t)},this.toInlineRange=t=>{const{rootElement:n,yText:i}=this.editor;return Bs(t,n,i)},this._applyInlineRange=t=>{const i=pt(this.editor).getSelection();if(!i)return;const r=this.toDomRange(t);r&&(i.removeAllRanges(),i.addRange(r),this.editor.slots.inlineRangeApply.emit(r))}}get inlineRangeProvider(){return this.editor.inlineRangeProvider}get rootElement(){return this.editor.rootElement}getNativeSelection(){const t=pt(this.editor).getSelection();return!t||t.rangeCount===0?null:t}getTextPoint(e){const t=Array.from(this.rootElement.querySelectorAll("v-line"));let n=0;for(const i of t){const r=W(i);for(const o of r){if(!o.textContent)throw new Error("text element should have textContent");if(n+o.textContent.length>=e)return[o,e-n];n+=Pt(o)}n+=1}throw new Error("failed to find leaf")}getLine(e){const t=Array.from(this.rootElement.querySelectorAll("v-line"));let n=0;for(const i of t){if(e>=n&&e<=n+i.textLength)return[i,e-n];if(e===n+i.textLength&&e===this.editor.yTextLength)return[i,e-n];n+=i.textLength+1}throw new Error("failed to find line")}}class si{constructor(e){this.editor=e,this.transact=this.editor.transact,this.deleteText=t=>{this.transact(()=>{this.yText.delete(t.index,t.length)})},this.insertText=(t,n,i={})=>{this.editor.attributeService.marks&&(i={...i,...this.editor.attributeService.marks});const r=this.editor.attributeService.normalizeAttributes(i);if(!n||!n.length)throw new Error("text must not be empty");this.transact(()=>{this.yText.delete(t.index,t.length),this.yText.insert(t.index,n,r)})},this.insertLineBreak=t=>{this.transact(()=>{this.yText.delete(t.index,t.length),this.yText.insert(t.index,`
`)})},this.formatText=(t,n,i={})=>{const{match:r=()=>!0,mode:o="merge"}=i;this.editor.deltaService.getDeltasByInlineRange(t).filter(([a,c])=>r(a,c)).forEach(([a,c])=>{const d=this.editor.attributeService.normalizeAttributes(n);if(!d)return;const h=ti(t,c);h&&(o==="replace"&&this.resetText(h),this.transact(()=>{this.yText.format(h.index,h.length,d)}))})},this.resetText=t=>{const n=[];for(let r=t.index;r<=t.index+t.length;r++){const o=this.editor.getDeltaByRangeIndex(r);o&&n.push(o)}const i=Object.fromEntries(n.flatMap(r=>r.attributes?Object.keys(r.attributes).map(o=>[o,null]):[]));this.transact(()=>{this.yText.format(t.index,t.length,{...i})})},this.setText=(t,n={})=>{this.transact(()=>{this.yText.delete(0,this.yText.length),this.yText.insert(0,t,n)})}}get yText(){return this.editor.yText}}class cr{constructor(e,t={}){if(this._disposables=new at,this._rootElement=null,this._eventSource=null,this._isReadonly=!1,this._eventService=new ei(this),this._rangeService=new ni(this),this._attributeService=new zs(this),this._deltaService=new Js(this),this._textService=new si(this),this._mounted=!1,this.slots={mounted:new J,unmounted:new J,textChange:new J,render:new J,renderComplete:new J,inlineRangeUpdate:new J,inlineRangeApply:new J},this.setAttributeSchema=this._attributeService.setAttributeSchema,this.setAttributeRenderer=this._attributeService.setAttributeRenderer,this.setMarks=this._attributeService.setMarks,this.resetMarks=this._attributeService.resetMarks,this.getFormat=this._attributeService.getFormat,this.toDomRange=this.rangeService.toDomRange,this.toInlineRange=this.rangeService.toInlineRange,this.getInlineRange=this.rangeService.getInlineRange,this.getInlineRangeFromElement=this.rangeService.getInlineRangeFromElement,this.getNativeSelection=this.rangeService.getNativeSelection,this.getTextPoint=this.rangeService.getTextPoint,this.getLine=this.rangeService.getLine,this.isValidInlineRange=this.rangeService.isValidInlineRange,this.isFirstLine=this.rangeService.isFirstLine,this.isLastLine=this.rangeService.isLastLine,this.setInlineRange=this.rangeService.setInlineRange,this.focusStart=this.rangeService.focusStart,this.focusEnd=this.rangeService.focusEnd,this.selectAll=this.rangeService.selectAll,this.focusIndex=this.rangeService.focusIndex,this.syncInlineRange=this.rangeService.syncInlineRange,this.getDeltasByInlineRange=this.deltaService.getDeltasByInlineRange,this.getDeltaByRangeIndex=this.deltaService.getDeltaByRangeIndex,this.mapDeltasInInlineRange=this.deltaService.mapDeltasInInlineRange,this.isNormalizedDeltaSelected=this.deltaService.isNormalizedDeltaSelected,this.deleteText=this._textService.deleteText,this.insertText=this._textService.insertText,this.insertLineBreak=this._textService.insertLineBreak,this.formatText=this._textService.formatText,this.resetText=this._textService.resetText,this.setText=this._textService.setText,this._onYTextChange=()=>{if(this.yText.toString().includes("\r"))throw new Error('yText must not contain "\\r" because it will break the range synchronization');this.slots.textChange.emit(),Promise.resolve().then(()=>this.deltaService.render()).catch(console.error)},!e.doc)throw new Error("yText must be attached to a Y.Doc");if(e.toString().includes("\r"))throw new Error('yText must not contain "\\r" because it will break the range synchronization');const{isEmbed:n=()=>!1,hooks:i={},inlineRangeProvider:r=null}=t;this._yText=e,this.isEmbed=n,this._hooksService=new ps(this,i),this.inlineRangeProvider=r,r&&r.inlineRangeUpdated.on(o=>{this.slots.inlineRangeUpdate.emit(o)}),this.slots.inlineRangeUpdate.on(this.rangeService.onInlineRangeUpdated)}static{this.nativePointToTextPoint=fe}static{this.textPointToDomPoint=mt}static{this.getTextNodesFromElement=W}get disposables(){return this._disposables}get yText(){return this._yText}get yTextString(){return this.yText.toString()}get yTextLength(){return this.yText.length}get yTextDeltas(){return this.yText.toDelta()}get rootElement(){return R(this._rootElement),this._rootElement}get eventSource(){return R(this._eventSource),this._eventSource}get eventService(){return this._eventService}get rangeService(){return this._rangeService}get attributeService(){return this._attributeService}get deltaService(){return this._deltaService}get mounted(){return this._mounted}get marks(){return this._attributeService.marks}get hooks(){return this._hooksService.hooks}get isComposing(){return this._eventService.isComposing}mount(e,t=e){const n=e;n.inlineEditor=this,this._rootElement=n,this._eventSource=t,Tt(Z,this._rootElement),this._rootElement.contentEditable="true",this._eventSource.contentEditable="true",this._rootElement.dataset.vRoot="true",this._bindYTextObserver(),this._eventService.mount(),this._mounted=!0,this.slots.mounted.emit(),this._deltaService.render().catch(console.error)}unmount(){this.rootElement.isConnected&&Tt(Z,this.rootElement),this.rootElement.removeAttribute(lt),this._rootElement=null,this._mounted=!1,this.disposables.dispose(),this.slots.unmounted.emit()}requestUpdate(e=!0){this._deltaService.render(e).catch(console.error)}async waitForUpdate(){const e=Array.from(this.rootElement.querySelectorAll("v-line"));await Promise.all(e.map(t=>t.updateComplete))}setReadonly(e){this.rootElement.contentEditable=e?"false":"true",this._isReadonly=e}get isReadonly(){return this._isReadonly}rerenderWholeEditor(){this.rootElement.isConnected&&(Tt(Z,this.rootElement),this._deltaService.render().catch(console.error))}transact(e){const t=this.yText.doc;if(!t)throw new Error("yText is not attached to a doc");t.transact(e,t.clientID)}_bindYTextObserver(){this.yText.observe(this._onYTextChange),this.disposables.add({dispose:()=>{this.yText.unobserve(this._onYTextChange)}})}}function Se(s){class e extends s{constructor(){super(...arguments),this._disposables=new at}get disposables(){return this._disposables}connectedCallback(){super.connectedCallback(),this._disposables.disposed&&(this._disposables=new at)}disconnectedCallback(){super.disconnectedCallback(),this._disposables.dispose()}}return e}class rn extends K{static{this.disableShadowRoot=!0}static finalizeStyles(e){let t=super.finalizeStyles(e);return this.disableShadowRoot&&(t.forEach(n=>{if(n instanceof we&&typeof document<"u"){const i=document.head,r=document.createElement("style");r.textContent=n.cssText,i.appendChild(r)}else console.error("unreachable")}),t=[]),t}createRenderRoot(){return this.constructor.disableShadowRoot?this:super.createRenderRoot()}}var ii=Object.defineProperty,ri=Object.getOwnPropertyDescriptor,bt=(s,e,t,n)=>{for(var i=n>1?void 0:n?ri(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&ii(e,t,i),i};class Et extends Se(rn){constructor(){super(...arguments),this.content=null,this.selected=null,this.handleEvent=(e,t,n)=>{R(this.path,"Cannot bind block level hotkey without path");const i={flavour:n?.global?void 0:n?.flavour?this.model.flavour:void 0,path:n?.global||n?.flavour?void 0:this.path};this._disposables.add(this.host.event.add(e,t,i))},this.renderModel=e=>this.host.renderModel(e),this.renderModelChildren=e=>this.host.renderModelChildren(e)}get parentPath(){return this.path.slice(0,-1)}get parentBlockElement(){const e=this.parentElement;R(e);const t=this.host.view.getNodeView(e);return R(t),t.view}get childBlockElements(){return this.host.view.getChildren(this.path).filter(t=>t.type==="block").map(t=>t.view)}get flavour(){return this.model.flavour}get widgetElements(){return Object.keys(this.widgets).reduce((e,t)=>({...e,[t]:this.host.view.viewFromPath("widget",[...this.path,t])}),{})}get service(){return this.host.std.spec.getService(this.model.flavour)}get selection(){return this.host.selection}get std(){return this.host.std}bindHotKey(e,t){R(this.path,"Cannot bind block level hotkey without path");const n={flavour:t?.global?void 0:t?.flavour?this.model.flavour:void 0,path:t?.global||t?.flavour?void 0:this.path};this._disposables.add(this.host.event.bindHotkey(e,n))}async getUpdateComplete(){const e=await super.getUpdateComplete();return await Promise.all(this.childBlockElements.map(t=>t.updateComplete)),e}connectedCallback(){super.connectedCallback(),this.path=this.host.view.calculatePath(this),this._disposables.add(this.model.propsUpdated.on(()=>{this.requestUpdate()})),this._disposables.add(this.model.childrenUpdated.on(()=>{this.requestUpdate()})),this._disposables.add(this.host.selection.slots.changed.on(e=>{const t=e.find(n=>A.equals(n.path,this.path));if(!t){this.selected=null;return}this.selected=t}))}disconnectedCallback(){super.disconnectedCallback()}render(){return null}}bt([P({attribute:!1})],Et.prototype,"host",2);bt([P({attribute:!1})],Et.prototype,"model",2);bt([P({attribute:!1})],Et.prototype,"content",2);bt([P({attribute:!1,hasChanged(s,e){return!s||!e?s!==e:!Object.keys(s).length&&!Object.keys(e).length?!1:s!==e}})],Et.prototype,"widgets",2);bt([P({attribute:!1})],Et.prototype,"page",2);bt([rs({hasChanged(s,e){return!s||!e?s!==e:!s?.equals(e)}})],Et.prototype,"selected",2);class oi{constructor(e){this.manager=e,this._prevSelection=null,this._filter={},this._isComposing=!1,this._onSelectionModelChanged=t=>{if(!this.host.event.isActive)return;const n=requestAnimationFrame(()=>{const i=t.find(o=>o.is("text"))??null;this.filter.textSelectionToRange&&!this.filter.textSelectionToRange(i)||(i&&this._prevSelection?i.equals(this._prevSelection):i===this._prevSelection)||(this._prevSelection=i,this._rangeManager.syncTextSelectionToRange(i))});this.host.disposables.add(()=>{cancelAnimationFrame(n)})},this.host.disposables.add(this._selectionManager.slots.changed.on(this._onSelectionModelChanged)),this.host.event.add("compositionStart",()=>{this._isComposing=!0}),this.host.event.add("compositionEnd",()=>{this._isComposing=!1}),this.host.disposables.add(this.host.event.add("selectionChange",()=>{const t=window.getSelection();if(!t){this._selectionManager.clear();return}const n=t.rangeCount>0?t.getRangeAt(0):null,i=!!t.anchorNode&&!!t.focusNode&&(t.anchorNode===t.focusNode?t.anchorOffset>t.focusOffset:t.anchorNode.compareDocumentPosition(t.focusNode)===Node.DOCUMENT_POSITION_PRECEDING);this.filter.rangeToTextSelection&&!this.filter.rangeToTextSelection(n)||this._isComposing||(n===null||n.intersectsNode(this.host)?this._prevSelection=this._rangeManager.syncRangeToTextSelection(n,i):(this._prevSelection=null,this._selectionManager.clear(["text"])))})),this.host.disposables.add(this.host.event.add("beforeInput",t=>{const n=t.get("defaultState").event;if(this.host.page.readonly)return;const i=this._selectionManager.find("text");i&&this._beforeTextInput(i,n)}))}get filter(){return this._filter}setFilter(e){this._filter=e}get _selectionManager(){return this.host.selection}get _rangeManager(){return R(this.host.rangeManager),this.host.rangeManager}get host(){return this.manager.host}_beforeTextInput(e,t){const{from:n,to:i}=e;if(!i||A.equals(n.path,i.path))return;const r=this._rangeManager.value;if(!r)return;const o=this._rangeManager.getSelectedBlockElementsByRange(r,{match:f=>f.model.role==="content",mode:"flat"}),l=o.at(0),a=o.at(-1);if(!l||!a)return;const c=l.model.text,d=a.model.text;if(!c||!d)return;const h=i.length===d.length;this.host.page.transact(()=>{h&&t.isComposing&&this._shamefullyResetIMERangeBeforeInput(c,l,n),c.delete(n.index,n.length),c.insert(t.data??"",n.index),h||(d.delete(0,i.length),c.join(d)),o.slice(1).reverse().forEach(f=>{const p=this.host.page.getParent(f.model);R(p),this.host.page.deleteBlock(f.model,{bringChildrenTo:p})})});const u=this._selectionManager.create("text",{from:{path:n.path,index:n.index+(t.data?.length??0),length:0},to:null});this._selectionManager.set([u])}_shamefullyResetIMERangeBeforeInput(e,t,n){e.delete(n.index,e.length-n.index);const r=W(t).at(-1),o=document.getSelection();if(r&&o){const l=document.createRange();l.selectNode(r),l.setStart(r,r.length),l.collapse(),o.removeAllRanges(),o.addRange(l)}}}class ai{constructor(e){this.host=e,this.rangeSynchronizer=new oi(this),this._range=null,this._isRangeReversed=!1}get value(){return this._range}clearRange(e=!0){this._range=null,this._isRangeReversed=!1,window.getSelection()?.removeAllRanges(),e&&this.host.selection.clear(["text"])}renderRange(e,t){const n=[e];t&&n.push(t);const i=this._mergeRanges(n);this._range=i?.range??null,this._isRangeReversed=i?.reversed??!1,this._renderRange()}syncTextSelectionToRange(e){if(!e){this.clearRange(!1);return}const{from:t,to:n}=e;if(!this.host.view.viewFromPath("block",t.path)){this.clearRange();return}const r=this.pointToRange(t),o=n?this.pointToRange(n):null;if(!r){this.clearRange(!1);return}this.renderRange(r,o)}syncRangeToTextSelection(e,t){if(!e)return this.clearRange(),null;const n=this.host.selection;this._range=e,this._isRangeReversed=t;const{startContainer:i,endContainer:r}=e,o=this._nodeToPoint(i),l=e.collapsed?null:this._nodeToPoint(r);if(!o)return n.find("text")&&n.clear(["text"]),null;const a=n.create("text",{from:o,to:l,isReverse:t});return n.setGroup("note",[a]),a}getSelectedBlockElementsByRange(e,t={}){const{mode:n="all",match:i=()=>!0}=t;let r=Array.from(this.host.querySelectorAll(`[${this.host.blockIdAttr}]:not([data-queryable="false"])`)).filter(a=>e.intersectsNode(a)&&i(a));if(r.length===0)return[];const l=(e.startContainer instanceof Element?e.startContainer:e.startContainer.parentElement)?.closest(`[${this.host.blockIdAttr}]`);if(R(l),n==="flat")r=r.filter(a=>l.compareDocumentPosition(a)&Node.DOCUMENT_POSITION_FOLLOWING||a===l);else if(n==="highest"){let a=r[0];r=r.filter((c,d)=>d===0?!0:a.compareDocumentPosition(c)&Node.DOCUMENT_POSITION_CONTAINED_BY?!1:(a=c,!0))}return r}textSelectionToRange(e){const{from:t,to:n}=e;if(!this.host.view.viewFromPath("block",t.path))return null;const r=this.pointToRange(t),o=n?this.pointToRange(n):null;if(!r)return null;const l=[r];return o&&l.push(o),this._mergeRanges(l)?.range??null}pointToRange(e){const t=this._calculateInlineEditor(e);if(!t)return null;const[n,i]=t;return n.toDomRange(i)}_calculateInlineEditor(e){const t=this.host.view.viewFromPath("block",e.path);if(!t)return null;const n=t.querySelector(`[${lt}]`);R(n,`Cannot find inline editor element in block ${e.path.join(" > ")}}`);const i=n.inlineEditor.yText.length,r=e.index>=i?i:e.index,o=r+e.length>=i?i-r:e.length;return[n.inlineEditor,{index:r,length:o}]}_nodeToPoint(e){const t=this._getNearestInlineEditor(e);if(!t)return null;const n=this._getBlock(t);if(!n)return null;const i=this._range?t.inlineEditor.toInlineRange(this._range):null;return i?{blockId:n.model.id,path:n.path,index:i.index,length:i.length}:null}_snapshotToRange(e){const t=document.createRange();return t.setStart(e.startContainer,e.startOffset),t.setEnd(e.endContainer,e.endOffset),t}_mergeRanges(e){if(e.length===0)return null;if(e.length===1){const[c]=e,d=document.createRange();return d.setStart(c.startContainer,c.startOffset),d.setEnd(c.endContainer,c.endOffset),{range:d,reversed:!1}}const[t,n]=e;let i=this._snapshotToRange(t),r=this._snapshotToRange(n);const o=e.slice(2),l=i.compareBoundaryPoints(Range.END_TO_START,r);for(l>0&&([i,r]=[r,i]);o.length>0;){const c=o.pop();if(!c)break;const d=this._snapshotToRange(c),h=d.compareBoundaryPoints(Range.START_TO_END,i),u=d.compareBoundaryPoints(Range.END_TO_START,r);h<0&&(i=d),u>0&&(r=d)}const a=document.createRange();return a.setStart(i.startContainer,i.startOffset),a.setEnd(r.endContainer,r.endOffset),i.detach(),r.detach(),{range:a,reversed:l>0}}_renderRange(){const e=document.getSelection();if(!e||!this._range){this.clearRange();return}if(e.removeAllRanges(),this._isRangeReversed){const t=document.createRange();t.setStart(this._range.endContainer,this._range.endOffset),e.addRange(t),e.extend(this._range.startContainer,this._range.startOffset)}else e.addRange(this._range)}_getNearestInlineEditor(e){let t;if(e instanceof Element?t=e:t=e.parentElement,!!t)return t.closest(`[${lt}]`)}_getBlock(e){return e.closest(`[${this.host.blockIdAttr}]`)}}var li=Object.defineProperty,ci=Object.getOwnPropertyDescriptor,Dt=(s,e,t,n)=>{for(var i=n>1?void 0:n?ci(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&li(e,t,i),i};let _t=class extends Se(rn){constructor(){super(...arguments),this.blockIdAttr="data-block-id",this.widgetIdAttr="data-widget-id",this.rangeManager=null,this.renderModel=s=>{const{flavour:e}=s;if(!this.page.schema.flavourSchemaMap.get(e))return console.warn(`Cannot find schema for ${e}.`),St`${Z}`;const n=this.std.spec.getView(e);if(!n)return console.warn(`Cannot find view for ${e}.`),St`${Z}`;const i=n.component,r=n.widgets?Object.entries(n.widgets).reduce((o,[l,a])=>{const c=St`<${a} ${ke(this.widgetIdAttr)}=${l} .host=${this} .page=${this.page}></${a}>`;return{...o,[l]:c}},{}):{};return St`<${i}
      ${ke(this.blockIdAttr)}=${s.id}
      .host=${this}
      .page=${this.page}
      .model=${s}
      .widgets=${r}
    ></${i}>`},this.renderModelChildren=s=>St`${sn(s.children,e=>e.id,e=>this.renderModel(e))}`,this._registerView=()=>{const s=`[${this.blockIdAttr}]`,e=`[${this.widgetIdAttr}]`;this.std.view.register({type:"block",fromDOM:t=>Ke(t,this.blockIdAttr,this.widgetIdAttr,"block"),toDOM:({view:t})=>t,getChildren:t=>We(t,s,e,"block")}),this.std.view.register({type:"widget",fromDOM:t=>Ke(t,this.widgetIdAttr,this.blockIdAttr,"widget"),toDOM:({view:t})=>t,getChildren:t=>We(t,s,e,"widget")})}}get command(){return this.std.command}get event(){return this.std.event}get selection(){return this.std.selection}get view(){return this.std.view}get spec(){return this.std.spec}willUpdate(s){s.has("specs")&&this.std.spec.applySpecs(this.specs),super.willUpdate(s)}async getUpdateComplete(){const s=await super.getUpdateComplete(),e=this.page.root;R(e);const t=this.std.spec.getView(e.flavour);R(t);const n=Object.values(t.widgets??{}),i=[t.component,...n];return await Promise.all(i.map(r=>{const o=this.renderRoot.querySelector(r._$litStatic$);if(o instanceof K)return o.updateComplete})),s}connectedCallback(){if(super.connectedCallback(),!this.page.root)throw new Error("This page is missing root block. Please initialize the default block structure before connecting the editor to DOM.");this.std=new zn({host:this,workspace:this.page.workspace,page:this.page}),this._registerView(),this.std.mount(),this.std.spec.applySpecs(this.specs),this.rangeManager=new ai(this)}disconnectedCallback(){super.disconnectedCallback(),this.std.unmount(),this.rangeManager=null}render(){const{root:s}=this.page;return s?this.renderModel(s):Z}};Dt([P({attribute:!1})],_t.prototype,"specs",2);Dt([P({attribute:!1})],_t.prototype,"page",2);Dt([P({attribute:!1})],_t.prototype,"blockIdAttr",2);Dt([P({attribute:!1})],_t.prototype,"widgetIdAttr",2);_t=Dt([Qt("editor-host")],_t);function Ke(s,e,t,n){const i=`[${e}]`,r=`[${t}]`,o=s&&s instanceof HTMLElement?s:s.parentElement;if(!o)return null;const l=o.closest(i);if(!l)return null;const a=o.closest(r);if(l.contains(a))return null;const c=l.getAttribute(e);return R(c),{id:c,path:l.path,view:l,type:n}}function We(s,e,t,n){const i=`${e},${t}`;return Array.from(s.querySelectorAll(i)).filter(r=>r.parentElement?.closest(n==="block"?e:t)===s)}var hi=Object.defineProperty,di=Object.getOwnPropertyDescriptor,on=(s,e,t,n)=>{for(var i=n>1?void 0:n?di(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(i=(n?o(e,t,i):o(i))||i);return n&&i&&hi(e,t,i),i};class an extends Se(K){constructor(){super(...arguments),this.handleEvent=(e,t,n)=>{this._disposables.add(this.host.event.add(e,t,{flavour:n?.global?void 0:this.flavour}))}}get widgetName(){return this.path[this.path.length-1]}get hostPath(){return this.path.slice(0,-1)}get blockElement(){const e=this.parentElement;R(e);const t=this.host.view.getNodeView(e);return R(t),t.view}get flavour(){return R(this.blockElement),this.blockElement.model.flavour}get std(){return this.host.std}bindHotKey(e,t){this._disposables.add(this.host.event.bindHotkey(e,{flavour:t?.global?void 0:this.flavour}))}connectedCallback(){super.connectedCallback(),this.path=this.host.view.calculatePath(this)}render(){return null}}on([P({attribute:!1})],an.prototype,"host",2);on([P({attribute:!1})],an.prototype,"page",2);const ui=["top","right","bottom","left"],Ye=["start","end"],Xe=ui.reduce((s,e)=>s.concat(e,e+"-"+Ye[0],e+"-"+Ye[1]),[]),z=Math.min,D=Math.max,Kt=Math.round,Nt=Math.floor,nt=s=>({x:s,y:s}),fi={left:"right",right:"left",bottom:"top",top:"bottom"},pi={start:"end",end:"start"};function me(s,e,t){return D(s,z(e,t))}function X(s,e){return typeof s=="function"?s(e):s}function U(s){return s.split("-")[0]}function q(s){return s.split("-")[1]}function Re(s){return s==="x"?"y":"x"}function Ce(s){return s==="y"?"height":"width"}function ut(s){return["top","bottom"].includes(U(s))?"y":"x"}function Te(s){return Re(ut(s))}function ln(s,e,t){t===void 0&&(t=!1);const n=q(s),i=Te(s),r=Ce(i);let o=i==="x"?n===(t?"end":"start")?"right":"left":n==="start"?"bottom":"top";return e.reference[r]>e.floating[r]&&(o=Yt(o)),[o,Yt(o)]}function gi(s){const e=Yt(s);return[Wt(s),e,Wt(e)]}function Wt(s){return s.replace(/start|end/g,e=>pi[e])}function mi(s,e,t){const n=["left","right"],i=["right","left"],r=["top","bottom"],o=["bottom","top"];switch(s){case"top":case"bottom":return t?e?i:n:e?n:i;case"left":case"right":return e?r:o;default:return[]}}function _i(s,e,t,n){const i=q(s);let r=mi(U(s),t==="start",n);return i&&(r=r.map(o=>o+"-"+i),e&&(r=r.concat(r.map(Wt)))),r}function Yt(s){return s.replace(/left|right|bottom|top/g,e=>fi[e])}function vi(s){return{top:0,right:0,bottom:0,left:0,...s}}function Ae(s){return typeof s!="number"?vi(s):{top:s,right:s,bottom:s,left:s}}function vt(s){return{...s,top:s.y,left:s.x,right:s.x+s.width,bottom:s.y+s.height}}function Ge(s,e,t){let{reference:n,floating:i}=s;const r=ut(e),o=Te(e),l=Ce(o),a=U(e),c=r==="y",d=n.x+n.width/2-i.width/2,h=n.y+n.height/2-i.height/2,u=n[l]/2-i[l]/2;let f;switch(a){case"top":f={x:d,y:n.y-i.height};break;case"bottom":f={x:d,y:n.y+n.height};break;case"right":f={x:n.x+n.width,y:h};break;case"left":f={x:n.x-i.width,y:h};break;default:f={x:n.x,y:n.y}}switch(q(e)){case"start":f[o]-=u*(t&&c?-1:1);break;case"end":f[o]+=u*(t&&c?-1:1);break}return f}const yi=async(s,e,t)=>{const{placement:n="bottom",strategy:i="absolute",middleware:r=[],platform:o}=t,l=r.filter(Boolean),a=await(o.isRTL==null?void 0:o.isRTL(e));let c=await o.getElementRects({reference:s,floating:e,strategy:i}),{x:d,y:h}=Ge(c,n,a),u=n,f={},p=0;for(let _=0;_<l.length;_++){const{name:w,fn:m}=l[_],{x,y:v,data:S,reset:b}=await m({x:d,y:h,initialPlacement:n,placement:u,strategy:i,middlewareData:f,rects:c,platform:o,elements:{reference:s,floating:e}});if(d=x??d,h=v??h,f={...f,[w]:{...f[w],...S}},b&&p<=50){p++,typeof b=="object"&&(b.placement&&(u=b.placement),b.rects&&(c=b.rects===!0?await o.getElementRects({reference:s,floating:e,strategy:i}):b.rects),{x:d,y:h}=Ge(c,u,a)),_=-1;continue}}return{x:d,y:h,placement:u,strategy:i,middlewareData:f}};async function se(s,e){var t;e===void 0&&(e={});const{x:n,y:i,platform:r,rects:o,elements:l,strategy:a}=s,{boundary:c="clippingAncestors",rootBoundary:d="viewport",elementContext:h="floating",altBoundary:u=!1,padding:f=0}=X(e,s),p=Ae(f),w=l[u?h==="floating"?"reference":"floating":h],m=vt(await r.getClippingRect({element:(t=await(r.isElement==null?void 0:r.isElement(w)))==null||t?w:w.contextElement||await(r.getDocumentElement==null?void 0:r.getDocumentElement(l.floating)),boundary:c,rootBoundary:d,strategy:a})),x=h==="floating"?{...o.floating,x:n,y:i}:o.reference,v=await(r.getOffsetParent==null?void 0:r.getOffsetParent(l.floating)),S=await(r.isElement==null?void 0:r.isElement(v))?await(r.getScale==null?void 0:r.getScale(v))||{x:1,y:1}:{x:1,y:1},b=vt(r.convertOffsetParentRelativeRectToViewportRelativeRect?await r.convertOffsetParentRelativeRectToViewportRelativeRect({rect:x,offsetParent:v,strategy:a}):x);return{top:(m.top-b.top+p.top)/S.y,bottom:(b.bottom-m.bottom+p.bottom)/S.y,left:(m.left-b.left+p.left)/S.x,right:(b.right-m.right+p.right)/S.x}}const wi=s=>({name:"arrow",options:s,async fn(e){const{x:t,y:n,placement:i,rects:r,platform:o,elements:l,middlewareData:a}=e,{element:c,padding:d=0}=X(s,e)||{};if(c==null)return{};const h=Ae(d),u={x:t,y:n},f=Te(i),p=Ce(f),_=await o.getDimensions(c),w=f==="y",m=w?"top":"left",x=w?"bottom":"right",v=w?"clientHeight":"clientWidth",S=r.reference[p]+r.reference[f]-u[f]-r.floating[p],b=u[f]-r.reference[f],g=await(o.getOffsetParent==null?void 0:o.getOffsetParent(c));let y=g?g[v]:0;(!y||!await(o.isElement==null?void 0:o.isElement(g)))&&(y=l.floating[v]||r.floating[p]);const E=S/2-b/2,N=y/2-_[p]/2-1,T=z(h[m],N),I=z(h[x],N),O=T,j=y-_[p]-I,k=y/2-_[p]/2+E,M=me(O,k,j),L=!a.arrow&&q(i)!=null&&k!=M&&r.reference[p]/2-(k<O?T:I)-_[p]/2<0,V=L?k<O?k-O:k-j:0;return{[f]:u[f]+V,data:{[f]:M,centerOffset:k-M-V,...L&&{alignmentOffset:V}},reset:L}}});function xi(s,e,t){return(s?[...t.filter(i=>q(i)===s),...t.filter(i=>q(i)!==s)]:t.filter(i=>U(i)===i)).filter(i=>s?q(i)===s||(e?Wt(i)!==i:!1):!0)}const bi=function(s){return s===void 0&&(s={}),{name:"autoPlacement",options:s,async fn(e){var t,n,i;const{rects:r,middlewareData:o,placement:l,platform:a,elements:c}=e,{crossAxis:d=!1,alignment:h,allowedPlacements:u=Xe,autoAlignment:f=!0,...p}=X(s,e),_=h!==void 0||u===Xe?xi(h||null,f,u):u,w=await se(e,p),m=((t=o.autoPlacement)==null?void 0:t.index)||0,x=_[m];if(x==null)return{};const v=ln(x,r,await(a.isRTL==null?void 0:a.isRTL(c.floating)));if(l!==x)return{reset:{placement:_[0]}};const S=[w[U(x)],w[v[0]],w[v[1]]],b=[...((n=o.autoPlacement)==null?void 0:n.overflows)||[],{placement:x,overflows:S}],g=_[m+1];if(g)return{data:{index:m+1,overflows:b},reset:{placement:g}};const y=b.map(T=>{const I=q(T.placement);return[T.placement,I&&d?T.overflows.slice(0,2).reduce((O,j)=>O+j,0):T.overflows[0],T.overflows]}).sort((T,I)=>T[1]-I[1]),N=((i=y.filter(T=>T[2].slice(0,q(T[0])?2:3).every(I=>I<=0))[0])==null?void 0:i[0])||y[0][0];return N!==l?{data:{index:m+1,overflows:b},reset:{placement:N}}:{}}}},Ei=function(s){return s===void 0&&(s={}),{name:"flip",options:s,async fn(e){var t,n;const{placement:i,middlewareData:r,rects:o,initialPlacement:l,platform:a,elements:c}=e,{mainAxis:d=!0,crossAxis:h=!0,fallbackPlacements:u,fallbackStrategy:f="bestFit",fallbackAxisSideDirection:p="none",flipAlignment:_=!0,...w}=X(s,e);if((t=r.arrow)!=null&&t.alignmentOffset)return{};const m=U(i),x=U(l)===l,v=await(a.isRTL==null?void 0:a.isRTL(c.floating)),S=u||(x||!_?[Yt(l)]:gi(l));!u&&p!=="none"&&S.push(..._i(l,_,p,v));const b=[l,...S],g=await se(e,w),y=[];let E=((n=r.flip)==null?void 0:n.overflows)||[];if(d&&y.push(g[m]),h){const O=ln(i,o,v);y.push(g[O[0]],g[O[1]])}if(E=[...E,{placement:i,overflows:y}],!y.every(O=>O<=0)){var N,T;const O=(((N=r.flip)==null?void 0:N.index)||0)+1,j=b[O];if(j)return{data:{index:O,overflows:E},reset:{placement:j}};let k=(T=E.filter(M=>M.overflows[0]<=0).sort((M,L)=>M.overflows[1]-L.overflows[1])[0])==null?void 0:T.placement;if(!k)switch(f){case"bestFit":{var I;const M=(I=E.map(L=>[L.placement,L.overflows.filter(V=>V>0).reduce((V,oe)=>V+oe,0)]).sort((L,V)=>L[1]-V[1])[0])==null?void 0:I[0];M&&(k=M);break}case"initialPlacement":k=l;break}if(i!==k)return{reset:{placement:k}}}return{}}}};function cn(s){const e=z(...s.map(r=>r.left)),t=z(...s.map(r=>r.top)),n=D(...s.map(r=>r.right)),i=D(...s.map(r=>r.bottom));return{x:e,y:t,width:n-e,height:i-t}}function Si(s){const e=s.slice().sort((i,r)=>i.y-r.y),t=[];let n=null;for(let i=0;i<e.length;i++){const r=e[i];!n||r.y-n.y>n.height/2?t.push([r]):t[t.length-1].push(r),n=r}return t.map(i=>vt(cn(i)))}const Ri=function(s){return s===void 0&&(s={}),{name:"inline",options:s,async fn(e){const{placement:t,elements:n,rects:i,platform:r,strategy:o}=e,{padding:l=2,x:a,y:c}=X(s,e),d=Array.from(await(r.getClientRects==null?void 0:r.getClientRects(n.reference))||[]),h=Si(d),u=vt(cn(d)),f=Ae(l);function p(){if(h.length===2&&h[0].left>h[1].right&&a!=null&&c!=null)return h.find(w=>a>w.left-f.left&&a<w.right+f.right&&c>w.top-f.top&&c<w.bottom+f.bottom)||u;if(h.length>=2){if(ut(t)==="y"){const T=h[0],I=h[h.length-1],O=U(t)==="top",j=T.top,k=I.bottom,M=O?T.left:I.left,L=O?T.right:I.right,V=L-M,oe=k-j;return{top:j,bottom:k,left:M,right:L,width:V,height:oe,x:M,y:j}}const w=U(t)==="left",m=D(...h.map(T=>T.right)),x=z(...h.map(T=>T.left)),v=h.filter(T=>w?T.left===x:T.right===m),S=v[0].top,b=v[v.length-1].bottom,g=x,y=m,E=y-g,N=b-S;return{top:S,bottom:b,left:g,right:y,width:E,height:N,x:g,y:S}}return u}const _=await r.getElementRects({reference:{getBoundingClientRect:p},floating:n.floating,strategy:o});return i.reference.x!==_.reference.x||i.reference.y!==_.reference.y||i.reference.width!==_.reference.width||i.reference.height!==_.reference.height?{reset:{rects:_}}:{}}}};async function Ci(s,e){const{placement:t,platform:n,elements:i}=s,r=await(n.isRTL==null?void 0:n.isRTL(i.floating)),o=U(t),l=q(t),a=ut(t)==="y",c=["left","top"].includes(o)?-1:1,d=r&&a?-1:1,h=X(e,s);let{mainAxis:u,crossAxis:f,alignmentAxis:p}=typeof h=="number"?{mainAxis:h,crossAxis:0,alignmentAxis:null}:{mainAxis:0,crossAxis:0,alignmentAxis:null,...h};return l&&typeof p=="number"&&(f=l==="end"?p*-1:p),a?{x:f*d,y:u*c}:{x:u*c,y:f*d}}const hr=function(s){return s===void 0&&(s=0),{name:"offset",options:s,async fn(e){var t,n;const{x:i,y:r,placement:o,middlewareData:l}=e,a=await Ci(e,s);return o===((t=l.offset)==null?void 0:t.placement)&&(n=l.arrow)!=null&&n.alignmentOffset?{}:{x:i+a.x,y:r+a.y,data:{...a,placement:o}}}}},Ti=function(s){return s===void 0&&(s={}),{name:"shift",options:s,async fn(e){const{x:t,y:n,placement:i}=e,{mainAxis:r=!0,crossAxis:o=!1,limiter:l={fn:w=>{let{x:m,y:x}=w;return{x:m,y:x}}},...a}=X(s,e),c={x:t,y:n},d=await se(e,a),h=ut(U(i)),u=Re(h);let f=c[u],p=c[h];if(r){const w=u==="y"?"top":"left",m=u==="y"?"bottom":"right",x=f+d[w],v=f-d[m];f=me(x,f,v)}if(o){const w=h==="y"?"top":"left",m=h==="y"?"bottom":"right",x=p+d[w],v=p-d[m];p=me(x,p,v)}const _=l.fn({...e,[u]:f,[h]:p});return{..._,data:{x:_.x-t,y:_.y-n}}}}},Ai=function(s){return s===void 0&&(s={}),{options:s,fn(e){const{x:t,y:n,placement:i,rects:r,middlewareData:o}=e,{offset:l=0,mainAxis:a=!0,crossAxis:c=!0}=X(s,e),d={x:t,y:n},h=ut(i),u=Re(h);let f=d[u],p=d[h];const _=X(l,e),w=typeof _=="number"?{mainAxis:_,crossAxis:0}:{mainAxis:0,crossAxis:0,..._};if(a){const v=u==="y"?"height":"width",S=r.reference[u]-r.floating[v]+w.mainAxis,b=r.reference[u]+r.reference[v]-w.mainAxis;f<S?f=S:f>b&&(f=b)}if(c){var m,x;const v=u==="y"?"width":"height",S=["top","left"].includes(U(i)),b=r.reference[h]-r.floating[v]+(S&&((m=o.offset)==null?void 0:m[h])||0)+(S?0:w.crossAxis),g=r.reference[h]+r.reference[v]+(S?0:((x=o.offset)==null?void 0:x[h])||0)-(S?w.crossAxis:0);p<b?p=b:p>g&&(p=g)}return{[u]:f,[h]:p}}}},Oi=function(s){return s===void 0&&(s={}),{name:"size",options:s,async fn(e){const{placement:t,rects:n,platform:i,elements:r}=e,{apply:o=()=>{},...l}=X(s,e),a=await se(e,l),c=U(t),d=q(t),h=ut(t)==="y",{width:u,height:f}=n.floating;let p,_;c==="top"||c==="bottom"?(p=c,_=d===(await(i.isRTL==null?void 0:i.isRTL(r.floating))?"start":"end")?"left":"right"):(_=c,p=d==="end"?"top":"bottom");const w=f-a[p],m=u-a[_],x=!e.middlewareData.shift;let v=w,S=m;if(h){const g=u-a.left-a.right;S=d||x?z(m,g):g}else{const g=f-a.top-a.bottom;v=d||x?z(w,g):g}if(x&&!d){const g=D(a.left,0),y=D(a.right,0),E=D(a.top,0),N=D(a.bottom,0);h?S=u-2*(g!==0||y!==0?g+y:D(a.left,a.right)):v=f-2*(E!==0||N!==0?E+N:D(a.top,a.bottom))}await o({...e,availableWidth:S,availableHeight:v});const b=await i.getDimensions(r.floating);return u!==b.width||f!==b.height?{reset:{rects:!0}}:{}}}};function st(s){return hn(s)?(s.nodeName||"").toLowerCase():"#document"}function B(s){var e;return(s==null||(e=s.ownerDocument)==null?void 0:e.defaultView)||window}function tt(s){var e;return(e=(hn(s)?s.ownerDocument:s.document)||window.document)==null?void 0:e.documentElement}function hn(s){return s instanceof Node||s instanceof B(s).Node}function Q(s){return s instanceof Element||s instanceof B(s).Element}function G(s){return s instanceof HTMLElement||s instanceof B(s).HTMLElement}function Je(s){return typeof ShadowRoot>"u"?!1:s instanceof ShadowRoot||s instanceof B(s).ShadowRoot}function It(s){const{overflow:e,overflowX:t,overflowY:n,display:i}=F(s);return/auto|scroll|overlay|hidden|clip/.test(e+n+t)&&!["inline","contents"].includes(i)}function $i(s){return["table","td","th"].includes(st(s))}function Oe(s){const e=$e(),t=F(s);return t.transform!=="none"||t.perspective!=="none"||(t.containerType?t.containerType!=="normal":!1)||!e&&(t.backdropFilter?t.backdropFilter!=="none":!1)||!e&&(t.filter?t.filter!=="none":!1)||["transform","perspective","filter"].some(n=>(t.willChange||"").includes(n))||["paint","layout","strict","content"].some(n=>(t.contain||"").includes(n))}function Pi(s){let e=yt(s);for(;G(e)&&!ie(e);){if(Oe(e))return e;e=yt(e)}return null}function $e(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function ie(s){return["html","body","#document"].includes(st(s))}function F(s){return B(s).getComputedStyle(s)}function re(s){return Q(s)?{scrollLeft:s.scrollLeft,scrollTop:s.scrollTop}:{scrollLeft:s.pageXOffset,scrollTop:s.pageYOffset}}function yt(s){if(st(s)==="html")return s;const e=s.assignedSlot||s.parentNode||Je(s)&&s.host||tt(s);return Je(e)?e.host:e}function dn(s){const e=yt(s);return ie(e)?s.ownerDocument?s.ownerDocument.body:s.body:G(e)&&It(e)?e:dn(e)}function kt(s,e,t){var n;e===void 0&&(e=[]),t===void 0&&(t=!0);const i=dn(s),r=i===((n=s.ownerDocument)==null?void 0:n.body),o=B(i);return r?e.concat(o,o.visualViewport||[],It(i)?i:[],o.frameElement&&t?kt(o.frameElement):[]):e.concat(i,kt(i,[],t))}function un(s){const e=F(s);let t=parseFloat(e.width)||0,n=parseFloat(e.height)||0;const i=G(s),r=i?s.offsetWidth:t,o=i?s.offsetHeight:n,l=Kt(t)!==r||Kt(n)!==o;return l&&(t=r,n=o),{width:t,height:n,$:l}}function Pe(s){return Q(s)?s:s.contextElement}function gt(s){const e=Pe(s);if(!G(e))return nt(1);const t=e.getBoundingClientRect(),{width:n,height:i,$:r}=un(e);let o=(r?Kt(t.width):t.width)/n,l=(r?Kt(t.height):t.height)/i;return(!o||!Number.isFinite(o))&&(o=1),(!l||!Number.isFinite(l))&&(l=1),{x:o,y:l}}const ki=nt(0);function fn(s){const e=B(s);return!$e()||!e.visualViewport?ki:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function Di(s,e,t){return e===void 0&&(e=!1),!t||e&&t!==B(s)?!1:e}function ht(s,e,t,n){e===void 0&&(e=!1),t===void 0&&(t=!1);const i=s.getBoundingClientRect(),r=Pe(s);let o=nt(1);e&&(n?Q(n)&&(o=gt(n)):o=gt(s));const l=Di(r,t,n)?fn(r):nt(0);let a=(i.left+l.x)/o.x,c=(i.top+l.y)/o.y,d=i.width/o.x,h=i.height/o.y;if(r){const u=B(r),f=n&&Q(n)?B(n):n;let p=u.frameElement;for(;p&&n&&f!==u;){const _=gt(p),w=p.getBoundingClientRect(),m=F(p),x=w.left+(p.clientLeft+parseFloat(m.paddingLeft))*_.x,v=w.top+(p.clientTop+parseFloat(m.paddingTop))*_.y;a*=_.x,c*=_.y,d*=_.x,h*=_.y,a+=x,c+=v,p=B(p).frameElement}}return vt({width:d,height:h,x:a,y:c})}function Ii(s){let{rect:e,offsetParent:t,strategy:n}=s;const i=G(t),r=tt(t);if(t===r)return e;let o={scrollLeft:0,scrollTop:0},l=nt(1);const a=nt(0);if((i||!i&&n!=="fixed")&&((st(t)!=="body"||It(r))&&(o=re(t)),G(t))){const c=ht(t);l=gt(t),a.x=c.x+t.clientLeft,a.y=c.y+t.clientTop}return{width:e.width*l.x,height:e.height*l.y,x:e.x*l.x-o.scrollLeft*l.x+a.x,y:e.y*l.y-o.scrollTop*l.y+a.y}}function Mi(s){return Array.from(s.getClientRects())}function pn(s){return ht(tt(s)).left+re(s).scrollLeft}function Ni(s){const e=tt(s),t=re(s),n=s.ownerDocument.body,i=D(e.scrollWidth,e.clientWidth,n.scrollWidth,n.clientWidth),r=D(e.scrollHeight,e.clientHeight,n.scrollHeight,n.clientHeight);let o=-t.scrollLeft+pn(s);const l=-t.scrollTop;return F(n).direction==="rtl"&&(o+=D(e.clientWidth,n.clientWidth)-i),{width:i,height:r,x:o,y:l}}function Li(s,e){const t=B(s),n=tt(s),i=t.visualViewport;let r=n.clientWidth,o=n.clientHeight,l=0,a=0;if(i){r=i.width,o=i.height;const c=$e();(!c||c&&e==="fixed")&&(l=i.offsetLeft,a=i.offsetTop)}return{width:r,height:o,x:l,y:a}}function Bi(s,e){const t=ht(s,!0,e==="fixed"),n=t.top+s.clientTop,i=t.left+s.clientLeft,r=G(s)?gt(s):nt(1),o=s.clientWidth*r.x,l=s.clientHeight*r.y,a=i*r.x,c=n*r.y;return{width:o,height:l,x:a,y:c}}function Ze(s,e,t){let n;if(e==="viewport")n=Li(s,t);else if(e==="document")n=Ni(tt(s));else if(Q(e))n=Bi(e,t);else{const i=fn(s);n={...e,x:e.x-i.x,y:e.y-i.y}}return vt(n)}function gn(s,e){const t=yt(s);return t===e||!Q(t)||ie(t)?!1:F(t).position==="fixed"||gn(t,e)}function Ui(s,e){const t=e.get(s);if(t)return t;let n=kt(s,[],!1).filter(l=>Q(l)&&st(l)!=="body"),i=null;const r=F(s).position==="fixed";let o=r?yt(s):s;for(;Q(o)&&!ie(o);){const l=F(o),a=Oe(o);!a&&l.position==="fixed"&&(i=null),(r?!a&&!i:!a&&l.position==="static"&&!!i&&["absolute","fixed"].includes(i.position)||It(o)&&!a&&gn(s,o))?n=n.filter(d=>d!==o):i=l,o=yt(o)}return e.set(s,n),n}function Fi(s){let{element:e,boundary:t,rootBoundary:n,strategy:i}=s;const o=[...t==="clippingAncestors"?Ui(e,this._c):[].concat(t),n],l=o[0],a=o.reduce((c,d)=>{const h=Ze(e,d,i);return c.top=D(h.top,c.top),c.right=z(h.right,c.right),c.bottom=z(h.bottom,c.bottom),c.left=D(h.left,c.left),c},Ze(e,l,i));return{width:a.right-a.left,height:a.bottom-a.top,x:a.left,y:a.top}}function ji(s){const{width:e,height:t}=un(s);return{width:e,height:t}}function Vi(s,e,t){const n=G(e),i=tt(e),r=t==="fixed",o=ht(s,!0,r,e);let l={scrollLeft:0,scrollTop:0};const a=nt(0);if(n||!n&&!r)if((st(e)!=="body"||It(i))&&(l=re(e)),n){const c=ht(e,!0,r,e);a.x=c.x+e.clientLeft,a.y=c.y+e.clientTop}else i&&(a.x=pn(i));return{x:o.left+l.scrollLeft-a.x,y:o.top+l.scrollTop-a.y,width:o.width,height:o.height}}function Qe(s,e){return!G(s)||F(s).position==="fixed"?null:e?e(s):s.offsetParent}function mn(s,e){const t=B(s);if(!G(s))return t;let n=Qe(s,e);for(;n&&$i(n)&&F(n).position==="static";)n=Qe(n,e);return n&&(st(n)==="html"||st(n)==="body"&&F(n).position==="static"&&!Oe(n))?t:n||Pi(s)||t}const Hi=async function(s){let{reference:e,floating:t,strategy:n}=s;const i=this.getOffsetParent||mn,r=this.getDimensions;return{reference:Vi(e,await i(t),n),floating:{x:0,y:0,...await r(t)}}};function qi(s){return F(s).direction==="rtl"}const zi={convertOffsetParentRelativeRectToViewportRelativeRect:Ii,getDocumentElement:tt,getClippingRect:Fi,getOffsetParent:mn,getElementRects:Hi,getClientRects:Mi,getDimensions:ji,getScale:gt,isElement:Q,isRTL:qi};function Ki(s,e){let t=null,n;const i=tt(s);function r(){clearTimeout(n),t&&t.disconnect(),t=null}function o(l,a){l===void 0&&(l=!1),a===void 0&&(a=1),r();const{left:c,top:d,width:h,height:u}=s.getBoundingClientRect();if(l||e(),!h||!u)return;const f=Nt(d),p=Nt(i.clientWidth-(c+h)),_=Nt(i.clientHeight-(d+u)),w=Nt(c),x={rootMargin:-f+"px "+-p+"px "+-_+"px "+-w+"px",threshold:D(0,z(1,a))||1};let v=!0;function S(b){const g=b[0].intersectionRatio;if(g!==a){if(!v)return o();g?o(!1,g):n=setTimeout(()=>{o(!1,1e-7)},100)}v=!1}try{t=new IntersectionObserver(S,{...x,root:i.ownerDocument})}catch{t=new IntersectionObserver(S,x)}t.observe(s)}return o(!0),r}function dr(s,e,t,n){n===void 0&&(n={});const{ancestorScroll:i=!0,ancestorResize:r=!0,elementResize:o=typeof ResizeObserver=="function",layoutShift:l=typeof IntersectionObserver=="function",animationFrame:a=!1}=n,c=Pe(s),d=i||r?[...c?kt(c):[],...kt(e)]:[];d.forEach(m=>{i&&m.addEventListener("scroll",t,{passive:!0}),r&&m.addEventListener("resize",t)});const h=c&&l?Ki(c,t):null;let u=-1,f=null;o&&(f=new ResizeObserver(m=>{let[x]=m;x&&x.target===c&&f&&(f.unobserve(e),cancelAnimationFrame(u),u=requestAnimationFrame(()=>{f&&f.observe(e)})),t()}),c&&!a&&f.observe(c),f.observe(e));let p,_=a?ht(s):null;a&&w();function w(){const m=ht(s);_&&(m.x!==_.x||m.y!==_.y||m.width!==_.width||m.height!==_.height)&&t(),_=m,p=requestAnimationFrame(w)}return t(),()=>{d.forEach(m=>{i&&m.removeEventListener("scroll",t),r&&m.removeEventListener("resize",t)}),h&&h(),f&&f.disconnect(),f=null,a&&cancelAnimationFrame(p)}}const ur=bi,fr=Ti,pr=Ei,gr=Oi,mr=wi,_r=Ri,vr=Ai,yr=(s,e,t)=>{const n=new Map,i={platform:zi,...t},r={...i.platform,_c:n};return yi(s,e,{...i,platform:r})};/**
 * @license
 * Copyright 2018 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const wr=ee(class extends ne{constructor(s){if(super(s),s.type!==te.ATTRIBUTE||s.name!=="class"||s.strings?.length>2)throw Error("`classMap()` can only be used in the `class` attribute and must be the only part in the attribute.")}render(s){return" "+Object.keys(s).filter(e=>s[e]).join(" ")+" "}update(s,[e]){if(this.it===void 0){this.it=new Set,s.strings!==void 0&&(this.st=new Set(s.strings.join(" ").split(/\s/).filter(n=>n!=="")));for(const n in e)e[n]&&!this.st?.has(n)&&this.it.add(n);return this.render(e)}const t=s.element.classList;for(const n of this.it)n in e||(t.remove(n),this.it.delete(n));for(const n in e){const i=!!e[n];i===this.it.has(n)||this.st?.has(n)||(i?(t.add(n),this.it.add(n)):(t.remove(n),this.it.delete(n)))}return Gt}});/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Ot=(s,e)=>{const t=s._$AN;if(t===void 0)return!1;for(const n of t)n._$AO?.(e,!1),Ot(n,e);return!0},Xt=s=>{let e,t;do{if((e=s._$AM)===void 0)break;t=e._$AN,t.delete(s),s=e}while(t?.size===0)},_n=s=>{for(let e;e=s._$AM;s=e){let t=e._$AN;if(t===void 0)e._$AN=t=new Set;else if(t.has(s))break;t.add(s),Xi(e)}};function Wi(s){this._$AN!==void 0?(Xt(this),this._$AM=s,_n(this)):this._$AM=s}function Yi(s,e=!1,t=0){const n=this._$AH,i=this._$AN;if(i!==void 0&&i.size!==0)if(e)if(Array.isArray(n))for(let r=t;r<n.length;r++)Ot(n[r],!1),Xt(n[r]);else n!=null&&(Ot(n,!1),Xt(n));else Ot(this,s)}const Xi=s=>{s.type==te.CHILD&&(s._$AP??=Yi,s._$AQ??=Wi)};class Gi extends ne{constructor(){super(...arguments),this._$AN=void 0}_$AT(e,t,n){super._$AT(e,t,n),_n(this),this.isConnected=e._$AU}_$AO(e,t=!0){e!==this.isConnected&&(this.isConnected=e,e?this.reconnected?.():this.disconnected?.()),t&&(Ot(this,e),Xt(this))}setValue(e){if(Ws(this._$Ct))this._$Ct._$AI(e,this);else{const t=[...this._$Ct._$AH];t[this._$Ci]=e,this._$Ct._$AI(t,this,0)}}disconnected(){}reconnected(){}}/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const xr=()=>new Ji;class Ji{}const de=new WeakMap,br=ee(class extends Gi{render(s){return Z}update(s,[e]){const t=e!==this.G;return t&&this.G!==void 0&&this.ot(void 0),(t||this.rt!==this.lt)&&(this.G=e,this.ct=s.options?.host,this.ot(this.lt=s.element)),Z}ot(s){if(typeof this.G=="function"){const e=this.ct??globalThis;let t=de.get(e);t===void 0&&(t=new WeakMap,de.set(e,t)),t.get(this.G)!==void 0&&this.G.call(this.ct,void 0),t.set(this.G,s),s!==void 0&&this.G.call(this.ct,s)}else this.G.value=s}get rt(){return typeof this.G=="function"?de.get(this.ct??globalThis)?.get(this.G):this.G?.value}disconnected(){this.rt===this.lt&&this.ot(void 0)}reconnected(){this.ot(this.lt)}});/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function Er(s,e,t){return s?e(s):t?.(s)}/**
 * @license
 * Copyright 2018 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Sr=s=>s??Z;export{te as $,Ut as A,Et as B,_r as C,br as D,_t as E,vr as F,Er as G,_s as H,lt as I,ms as J,or as K,Sr as L,xr as M,ur as N,se as O,A as P,gr as Q,ee as R,rn as S,Vt as T,ne as U,Xs as V,Se as W,sr as X,lr as Y,xt as Z,Ht as _,rr as a,Ws as a0,zi as a1,Rs as b,sn as c,ue as d,nr as e,yr as f,W as g,hr as h,tr as i,pr as j,Kn as k,Me as l,dr as m,P as n,wt as o,mr as p,fr as q,rs as r,K as s,Qt as t,cr as u,ar as v,wr as w,Jt as x,Rt as y,an as z};
//# sourceMappingURL=if-defined-nOwHCvYS.js.map
